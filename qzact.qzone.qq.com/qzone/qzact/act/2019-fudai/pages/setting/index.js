(function(){window.cache={pendant:-1,news:-1};var e=window.fudaiConfig;var t=function(e,t){if(browserInfo.isIos){return false}var n=navigator.userAgent||"";var o=/(V\S+_\S+_\S+_\S+_\S+_\S+_\S+)/;var r=((n.match(o)||[])[1]||"").toUpperCase();var s=((r.match(/(\d+\.\d+\.\d+_\d+)/)||[])[1]||"").replace("_",".");if(!r){return false}var a=function(e,t,n){if(!e[n]&&!t[n]){return 0}return(e[n]||0)-(t[n]||0)||a(e,t,n+1)};var i=a(s.split("."),(t+"").split("."),0);i=i<0?-1:i>0?1:0;switch(e){case"eq":return i===0;case"neq":return i!==0;case"lt":return i<0;case"nlt":return i>=0;case"gt":return i>0;case"ngt":return i<=0;default:return i}}("gt","7.9.8.998");var n={empty:function e(){},getCookie:function(e){var t=new RegExp("(?:^|;\\s*)"+e+"=([^;]*)"),n=document.cookie.match(t);return n&&n[1]||""},getToken:function(){var e=5381,t;t=n.getCookie("skey");for(var o=0,r=t.length;o<r;++o){e+=(e<<5)+t.charAt(o).charCodeAt()}return e&2147483647},getUin:function(){
var e=this.getCookie("p_uin")||this.getCookie("uin")||"";if(e){e=parseInt(e.replace("o",""),10)}return e},store:function(t,o){t=e.data.subStoreKey+n.getUin()+"-"+t;if(!window.localStorage){return}if(t&&o){localStorage.setItem(t,o);return}if(t&&o===null){localStorage.removeItem(t);return}if(t){return localStorage.getItem(t)}},encodeHtml:function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\x60/g,"&#96;").replace(/\x27/g,"&#39;").replace(/\x22/g,"&quot;")},openUrl:function(e){if(!e){return}if(window.mqq){mqq.ui.openUrl({url:e,target:1,style:1,QzoneUseQQBrowser:true})}else{location.href=e}},hasClass:function(e,t){if(!e){return false}var n=(e.className||"").split(/\s/);for(var o=0;o<n.length;o++){if(n[o]===t){return true}}return false},getUrlParam:function(e){var t=new RegExp("(\\?|#|&)"+e+"=(.*?)(&|#|$)");var n=(location.href||"").match(t);var o=decodeURIComponent(n?n[2]:"");return o},getReportCommonParam:function(e){if(cache.deviceInfo){
e&&e(cache.deviceInfo);return}var t=setTimeout(function(){console.info("getReportDeviceInfo timeout");e&&e("")},800);var n=Date.now();mqq.invoke("FD","getReportDeviceInfo",{arg:1},function(o){console.info("getReportDeviceInfo use time:"+(Date.now()-n)/1e3+"s,result:",o);var r=o.deviceInfo||"";if(r){cache.deviceInfo=r}clearTimeout(t);e&&e(r)})},showTips:function(e){mqq.ui.showDialog({title:"温馨提示",text:e,needOkBtn:true,needCancelBtn:false,okBtnText:"确定",cancelBtnText:"取消"},n.empty)},getResourceVersion:function(e){var t="resource-version";var o=n.store(t)||{};if(o){try{o=JSON.parse(o)}catch(e){}if(o.data&&Date.now()-o.expire<60*60*1e3){console.info("getResourceVersionId res in cache",o.data);e&&e(o.data);return}}var r=false;var s=setTimeout(function(){console.info("getResourceVersionId timeout ...");e&&e("")},1e3);mqq.invoke("FD","getResourceVersionId",{},function(o){console.info("getResourceVersionId res ",o);if(r){return}e&&e(o.version);n.store(t,JSON.stringify({data:o.version,
expire:Date.now()}));clearTimeout(s)})},getMsfTime:function(e){var t=false;setTimeout(function(){if(t){return}e&&e(Date.now());t=true},500);var n=Date.now();mqq.invoke("card","getTime",{ars:1},function(o){console.info("card getTime,use time:",(Date.now()-n)/1e3,"s,res:",o);if(t){return}e&&e(o.data);t=true})},ssoRequest:function(e,t,o,r){n.getResourceVersion(function(n){var s=false;var a=setTimeout(function(){s=true;r&&r({code:-1e4,msg:"活动太火爆，请稍后再试"})},1e4);t.cmd=e;if(n){t.version=n}console.info("send sso cmd",e,"request, data ",t);var i=Date.now();mqq.invoke("sso","uniAgent",t,function(e){console.info("sso response,use time",Date.now()-i,"ms,data：",e);if(s){return}clearTimeout(a);var t=e.data;if(t&&typeof t==="string"){try{t=JSON.parse(t)}catch(e){}}if(e.code===0&&t){o&&o(t||{})}else{r&&r(e)}})})}};var o={bind:function(){document.querySelector("#home_wrap").addEventListener("click",function(e){var t=e.target||e.srcElement;var n;while(t&&t.nodeType!==t.DOCUMENT_NODE){
n=t.getAttribute("data-hook");if(n){switch(n){case"setPendant":o.setPendant();break;case"setNewsRemind":o.setNewsRemind();break}e.preventDefault()}t=t.parentNode}})},setPendant:function(){var e=cache.pendant===1?0:1;console.info("setPendantStatus",{status:e});mqq.invoke(browserInfo.isIos?"FD":"FD_SWITCH","setPendantStatus",{status:e});cache.pendant=e;r.renderPendant();window.reportFudai({act_id:e===0?"93":"94"})},setNewsRemind:function(){if(o._lock){return}o._lock=true;var e=cache.news;var s=cache.news===1?0:1;cache.news=s;r.renderNewsRemind();n.ssoRequest("MQUpdateSvc_com_qq_qzone_qzs.web.fudai.set_remind_state",{state:s},function(e){if(!browserInfo.isIos&&t){mqq.invoke(browserInfo.isIos?"FD":"FD_SWITCH","setNewsStatus",{status:cache.news})}o._lock=false},function(){mqq.ui.showTips({text:"设置失败",iconMode:2});cache.news=e;r.renderNewsRemind();o._lock=false});window.reportFudai({act_id:s===1?"95":"96"})},getNewsRemind:function(e){
n.ssoRequest("MQUpdateSvc_com_qq_qzone_qzs.web.fudai.get_remind_state",{uin:n.getUin()},function(n){cache.news=n&&n.state;if(!browserInfo.isIos&&t){mqq.invoke(browserInfo.isIos?"FD":"FD_SWITCH","setNewsStatus",{status:cache.news})}e&&e()},function(){cache.news=0;e&&e()})},getPendantStatus:function(e){var t=false;setTimeout(function(){if(t){return}cache.pendant=1;t=true;e&&e(0);console.info("FD.getPendantStatus timeout")},1e3);mqq.invoke(browserInfo.isIos?"FD":"FD_SWITCH","getPendantStatus",{},function(n){console.info("FD.getPendantStatus,res",n);if(t){return}t=true;cache.pendant=n.status*1;e&&e(n.status)})}};var r={render:function(){if(mqq.compare("7.9.8")>=0&&browserInfo.isIos||t){document.querySelector("#j-pendant-wrap").style.display="-webkit-flex";document.querySelector("#j-pendant-wrap").style.display="flex";o.getPendantStatus(function(){r.renderPendant()})}o.getNewsRemind(function(){r.renderNewsRemind()})},renderPendant:function(){var e=document.querySelector("#j-pendant-btn")
;var t=document.querySelector("#j-pendant-loading");switch(cache.pendant*1){case 1:e.style.display="inline-block";e.className="switch-checked switch";t.style.display="none";break;case 0:e.style.display="inline-block";e.className="switch";t.style.display="none";break;default:e.style.display="none";t.style.display="block"}},renderNewsRemindLoading:function(){var e=document.querySelector("#j-news-btn");var t=document.querySelector("#j-news-loading");e.style.display="none";t.style.display="block"},renderNewsRemind:function(e){var t=document.querySelector("#j-news-btn");var n=document.querySelector("#j-news-loading");switch(cache.news*1){case 0:t.style.display="inline-block";t.className="switch-checked switch";n.style.display="none";break;case 1:t.style.display="inline-block";t.className="switch";n.style.display="none";break;default:t.style.display="none";n.style.display="block"}if(e){t.style.display="none";n.style.display="block"}}};r.render();o.bind()})();