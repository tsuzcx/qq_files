
﻿var regList=['popupDialog','closePopup','popupCallback','enterGameMode','quitGameMode','showMsgbox','hideMsgbox','checkLogin','showLoginBox','loginCallback','confirm','setScrollTop','getScrollTop','loadXMLAsync','loadJsonData','getBitMapFlag','getVipStatus','getVIPLevel','getQzonename','getNickname','$','enterMall','insertFlash','writePhotoBlog','g_iLoginUin','g_iUin','g_StyleID','g_NowTime','g_version','g_dns_name','g_XDoc','g_JData','QZONE','QZFL','isGameMode'];var QZFP=(function(){var res={};if(typeof QZONE!="undefined"&&QZONE.FP){for(var p;regList.length>0;){p=regList.pop();if(typeof QZONE.FP[p]!="undefined"){res[p]=QZONE.FP[p];}else if(typeof QZONE.FP._t[p]!="undefined"){res[p]=QZONE.FP._t[p];}}
var _t=QZONE.FP._t;_t.g_PData=new _t.Object();res.pGet=function(k){return _t.g_PData[k];}
res.pSet=function(k,v){return _t.g_PData[k]=v;}
res.pDel=function(k){_t.g_PData[k]=null;delete _t.g_PData[k];}
res._t=_t;}
regList=null;return res;})();var QZAPP=QZFP._t||top;var Timer=(function(){var _map={};var _s=0;function _get(k){var o=_map[k];if(!o){o=_map[k]={lt:_s,timer:null};}
return o;}
var inner;return inner={relax:function(fn,time,argArray){var t=new Date();var o=_get(fn);var d=t-o.lt;o.lt=t;clearTimeout(o.timer);var cfn=function(){argArray=argArray||[];fn.apply(null,([]).concat(argArray));}
if(d<time){o.timer=setTimeout(cfn,time+10);}else{cfn();}}}})();﻿
function MD5(sMessage)
{function RotateLeft(lValue,iShiftBits)
{return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));}
function AddUnsigned(lX,lY)
{var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4)return(lResult^0x80000000^lX8^lY8);if(lX4|lY4){if(lResult&0x40000000)return(lResult^0xC0000000^lX8^lY8);else return(lResult^0x40000000^lX8^lY8);}else return(lResult^lX8^lY8);}
function F(x,y,z){return(x&y)|((~x)&z);}
function G(x,y,z){return(x&z)|(y&(~z));}
function H(x,y,z){return(x^y^z);}
function I(x,y,z){return(y^(x|(~z)));}
function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}
function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}
function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}
function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}
function ConvertToWordArray(sMessage){var lWordCount;var lMessageLength=sMessage.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1%64))/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(sMessage.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;}
lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;}
function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValue_temp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);}
return WordToHexValue;}
var x=Array();var k,AA,BB,CC,DD,a,b,c,d
var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;x=ConvertToWordArray(sMessage);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD);}
var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase();}
var $extend=function(){var args=arguments;if(!args[1])args=[this,args[0]];for(var property in args[1]){var old=args[0][property]||QZONE.emptyFn;args[0][property]=args[1][property];args[0][property].parent=old;}
return args[0];};function $defined(obj){return(obj!=undefined);};function $merge(){var mix={};for(var i=0;i<arguments.length;i++){for(var property in arguments[i]){var ap=arguments[i][property];var mp=mix[property];if(mp&&$type(ap)=='object'&&$type(mp)=='object')mix[property]=$merge(mp,ap);else mix[property]=ap;}}
return mix;};function $type(obj){if(!$defined(obj))return false;if(obj.htmlElement)return'element';var type=typeof obj;if(type=='object'&&obj.nodeName){switch(obj.nodeType){case 1:return'element';case 3:return(/\S/).test(obj.nodeValue)?'textnode':'whitespace';}}
if(type=='object'||type=='function'){switch(obj.constructor){case Array:return'array';case RegExp:return'regexp';case Class:return'class';}
if(typeof obj.length=='number'){if(obj.item)return'collection';if(obj.callee)return'arguments';}}
return type;};var Class=function(properties){var klass=function(){return(arguments[0]!==null&&this.initialize&&$type(this.initialize)=='function')?this.initialize.apply(this,arguments):this;};$extend(klass,this);klass.prototype=properties;klass.constructor=Class;return klass;};Class.empty=function(){};Class.Merge=function(previous,current){if(previous&&previous!=current){var type=$type(current);if(type!=$type(previous))return current;switch(type){case'function':var merged=function(){this.parent=arguments.callee.parent;return current.apply(this,arguments);};merged.parent=previous;return merged;case'object':return $merge(previous,current);}}
return current;};Class.prototype={extend:function(properties){var proto=new this(null);for(var property in properties){var pp=proto[property];proto[property]=Class.Merge(pp,properties[property]);}
return new Class(proto);},implement:function(){for(var i=0,l=arguments.length;i<l;i++)$extend(this.prototype,arguments[i]);}};var version="1.0.2.2"
if(!QZAPP.g_XDoc)QZAPP.g_XDoc=[];var g_emText=new Array('微笑','撇嘴','色','发呆','得意','流泪','害羞','闭嘴','睡','大哭','尴尬','发怒','调皮','呲牙','惊讶','难过','酷','冷汗','抓狂','吐','偷笑','可爱','白眼','傲慢','饥饿','困','惊恐','流汗','憨笑','大兵','奋斗','咒骂','疑问','嘘','晕','折磨','衰','骷髅','敲打','再见','擦汗','抠鼻','鼓掌','糗大了','坏笑','左哼哼','右哼哼','哈欠','鄙视','委屈','快哭了','阴险','亲亲','吓','可怜','菜刀','西瓜','啤酒','篮球','乒乓','咖啡','饭','猪头','玫瑰','凋谢','示爱','爱心','心碎','蛋糕','闪电','炸弹','刀','足球','瓢虫','便便','月亮','太阳','礼物','拥抱','强','弱','握手','胜利','抱拳','勾引','拳头','差劲','爱你','NO','OK','爱情','飞吻','跳跳','发抖','怄火','转圈','磕头','回头','跳绳','挥手','激动','街舞','献吻','左太极','右太极');var isQzone=false;isQzone=(location.href.match("qzone")&&(!location.href.match("portal")))?true:false;if(!isQzone)isQzone=(location.href.match("izone"))?true:false;var Browser=new Object();Browser.isIE=window.ActiveXObject?true:false;Browser.isIE7=Browser.isIE&&window.XMLHttpRequest;Browser.isMozilla=Browser.isIE?false:(typeof document.implementation!='undefined')&&(typeof document.implementation.createDocument!='undefined')&&(typeof HTMLDocument!='undefined');Browser.isFirefox=Browser.isIE?false:(navigator.userAgent.toLowerCase().indexOf("firefox")!=-1);Browser.isSafari=Browser.isIE?false:(navigator.userAgent.toLowerCase().indexOf("safari")!=-1);Browser.isOpera=Browser.isIE?false:(navigator.userAgent.toLowerCase().indexOf("opera")!=-1);if(typeof(isQzone)!="undefine"&&isQzone)
QZAPP.isQzone=isQzone;var $show=function(e){try{QZONE.dom.get(e).style.display="";}catch(e){}};var $hide=function(e){try{QZONE.dom.get(e).style.display="none";}catch(e){}};var $showObj=function(o){try{o.style.display="";}catch(e){}};var $hideObj=function(o){try{o.style.display="none";}catch(e){}};function checkAlbumPriv(aid,priv){priv=parseInt(priv);if(priv>10)priv-=10;var checkCallback=function(){qz_go_imc("photo_list.htm",aid);}
if(checkAlbumLoaded(aid))
priv=1;if(QZAPP.g_iUin==QZAPP.g_iLoginUin&&priv==2)
priv=3;switch(priv){case 2:showPasswd();window.passwdSubmit=function(){var verifycode=$E("input_verifycode")!=null?$E("input_verifycode").value:null;if(!verifycode||$E("album_passwd").value==""){alert("密码或者验证码不能为空.");return;}
coverAll("正在处理中，请稍侯...");loadAlbumCallback(aid,checkCallback,$E("album_passwd").value,verifycode);}
break;case 3:loadAlbumCallback(aid,checkCallback);break;default:qz_go_imc("photo_list.htm",aid);}}
function checkAlbumLoaded(aid){var albums=QZAPP.g_XDoc[16].selectNodes("/data/album");var idx=getIndexByValue(albums,"id",aid);if(idx==null)
return false;var loaded=getNodeSubValue(albums[idx],"isLoaded");if(loaded==null)
return false;return true;}
function getIndexByValue(a,name,value){var id;for(var i=0;i<a.length;i++){id=getNodeSubValue(a[i],name);if(id==value){return i;}}
return null;}
function getNodeSubValue(node,name){if(!node)return null;var sub;if(typeof node.xml!="string"){return node[name];}
if((sub=XMLselectSingleNode(node,name))||(sub=node.getAttributeNode(name)))
{var ret;if((ret=sub.value)!=null||(ret=sub.text)!=null)
return ret;}
return null;}
function setNodeSubValue(node,name,value){if(!node)return"node illegal!";var sub;if((sub=XMLselectSingleNode(node,name))||(sub=node.getAttributeNode(name)))
{if(sub.nodeType==2)
sub.value=value;else if(sub.nodeType==1)
{if(sub.childNodes.length>0){for(var ii=sub.childNodes.length-1;ii>=0;ii--){QZONE.dom.removeElement(sub.childNodes[ii]);}}
var cdata=sub.ownerDocument.createCDATASection(value);sub.appendChild(cdata);}}
else
{node.setAttribute(name,value);}}
function setNodeElementValue(node,name,value){if(!node)return"node illegal!";var sub;if(!(sub=node.selectSingleNode(name))||(sub=node.getAttributeNode(name)))
{var newel=node.selectSingleNode("/").createElement(name);node.appendChild(newel);}
setNodeSubValue(node,name,value);}
function checkRetXml_old(o,needAlert){var ret;if(!o||o.xml==""||!(ret=o.selectSingleNode("return"))||getNodeSubValue(ret,"value")=="0"){if(needAlert){var msg;if(ret&&(msg=getNodeSubValue(ret,"msg"))){QZFP.showMsgbox(msg,5,3000);if(msg.match("登录")){try{if(QZAPP.showlogin)
QZAPP.showlogin(true);else{QZFP.showLoginBox("mall");}}catch(e){}}}
else
QZFP.showMsgbox("对不起，系统忙，请稍后再试",5,2000);}
return false;}
QZFP.hideMsgbox();return true;}
function checkRetXml(o,needAlert){function show(msg){if(needAlert){msg=msg||"对不起，系统忙，请稍后再试";alert(msg);if(msg.match("登录")){try{if(QZAPP.showlogin)
QZAPP.showlogin(true);else{QZFP.showLoginBox("mall");}}catch(e){}}}}
if(!o||o.xml==""){show();return false;}
var data,ret;if((data=XMLselectSingleNode(o,"data"))&&(ret=getNodeSubValue(data,"ret"))){if(ret=="0"){return true;}else{show(getNodeSubValue(data,"msg"));}}
return checkRetXml_old(o,needAlert);}
var g_PhotoImgcachePath="/qzone/client/photo/";var g_PhotoImgcacheHtdocsPath=g_PhotoImgcachePath+"pages/";var $=function(id){return document.getElementById(id);}
var version="1.0.2.2";function go(link,aid,lloc,others){var url="";if(!link.match(/^http/)){url="http://"+QZONE.FP._t.imgcacheDomain;if(!link.match(/^\//)){url+="/qzone/photo/zone/";}}
url+=link;var data=[];if(aid){data.push("aid="+aid);}
if(lloc){data.push("lloc="+lloc);}
if(others){data.push(others);}
if(data.length>0){url+=((url.indexOf("#")!=-1)?"&":"#")+data.join("&");}
try{window.location.href=url;}catch(e){frameElement.src=url;}}
var goLinkMap={"album_list.htm":"albumList.html","photo_list.htm":"photoList.html","photo_view.htm":"photoView.html","modifyed_guide.htm":"guide.html","flash_photo_list.htm":"flashList.html","flash_photo_view.htm":"flashView.html"}
function qz_go_imc(link,a_id,lloc,others){var gl;if(QZONE.FP._t.qz_go_imc_map){gl=QZONE.FP._t.qz_go_imc_map[link];}
if(!gl){gl=goLinkMap[link];;}
if(gl){go(gl,a_id,lloc,others);return;}
if(!link.match(/http\:\/\/.*\.qq\.com/)){link="http://"+QZONE.FP._t.imgcacheDomain+"/qzone/client/photo/pages/qzone_v4/"+link;}
link+="#"+version;if(a_id)link+="&a_id="+a_id;if(lloc)link+="&lloc="+encodeURIComponent(lloc);if(others)link+="&"+others;try{window.location.href=link;}catch(e){}}
Function.prototype.bindAsCallBack=function(obj){var _method=this;return function(xml){return _method.call(obj,xml);}}
Function.prototype.bind=function(obj){var _method=this;return function(){return _method.apply(obj,arguments);}}
Function.prototype.pass=function(){var args=arguments;var _method=this;return function(){return _method.apply(null,args);}}
function getParameter(name,cancelBubble){var r=new RegExp("(\\?|#|&)"+name+"=([^&#]*)(&|#|$)");var m=location.href.match(r);if((!m||m=="")&&!cancelBubble)m=QZAPP.location.href.match(r);return(!m?"":m[2]);}
function insertCSSLink(sID){try{if(/(setfail.htm)|(setsucc.htm)|(changeset.htm)|(alter_photo_cover.htm)|(cgi_upload_pic)/.test(location.href)){return;}
if($("g_style")){return;}
frameElement.g_styleUrl=frameElement.g_styleUrl||'/qzonestyle/qzone_client_v5/css/'+sID+'/color_out.css';var url=frameElement.g_styleUrl;var cssLink=document.createElement("link");cssLink.rel="stylesheet";cssLink.rev="stylesheet";cssLink.type="text/css";cssLink.media="screen";cssLink.href=url;cssLink.id="g_style";document.getElementsByTagName("head")[0].appendChild(cssLink);return cssLink.sheet||cssLink;}catch(e){}}
insertCSSLink(QZAPP.g_StyleID);var $A=function(emuable){var result=[];for(var i=0,iLen=emuable.length;i<iLen;i++){result.push(emuable[i]);}
return result;}
function cssChange(){var oStyleSheet=document.styleSheets[0];var ownerMode=User.isOwner();var rules=oStyleSheet.cssRules||oStyleSheet.rules;rules[0].style.display=(ownerMode)?"":"none";rules[1].style.display=(ownerMode)?"none":"";if(rules[2]&&(!QZONE.FP.isInPengyou||!QZONE.FP.isInPengyou())){rules[2].style.display='';}}
String.prototype.getRealLength=function(){return this.replace(/[^\x00-\xff]/g,"aa").length;}
String.prototype.URIencode=function(){return this.replace(/[\x09\x0A\x0D\x21-\x29\x2B\x2C\x2F\x3A-\x3F\x5B-\x5E\x60\x7B-\x7E]/g,function(a){return"%"+((a.charCodeAt(0)<16)?("0"+a.charCodeAt(0).toString(16)):(a.charCodeAt(0).toString(16)))}).replace(/[\x00-\x20 ]/g,"+");}
String.prototype.toInputField=function(){return this.replace(/&quot;/g,"\"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&apos;/g,"\'").replace(/&amp;/g,"&");}
String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");}
var div_for_convert_html=document.createElement("DIV");String.prototype.HTML2Text=function(){with(div_for_convert_html){innerHTML=this.replace(/(?:&#13;)|(?:\n)/g,"<br>").replace(/(?:&#32;)|(?: )/g,"&nbsp;");return(Browser.isIE?innerText:textContent).replace(/\xa0/g," ");};}
String.prototype.Text2HTML=function(){if(Browser.isIE){div_for_convert_html.innerText=this;return div_for_convert_html.innerHTML}
div_for_convert_html.textContent=this;return div_for_convert_html.innerHTML.replace(/\x0a/g,"<br>").replace(/ /g,"&nbsp;")}
String.prototype.entityReplace=function(){return this.replace(/&#38;?/g,"&amp;").replace(/&#(\d+);?/g,function(a,b){return String.fromCharCode(b)}).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&nbsp;/g," ").replace(/&#13;/g,"\n").replace(/(&#10;)|(&#x\w*;)/g,"").replace(/&amp;/g,"&");}
String.prototype.trueEntityReplace=function(){return this.replace(/&#(\d+);?/g,function(a,b){return String.fromCharCode(b)});}
String.prototype.unHtmlReplace=function(){return restXHTML(this);var s=(this).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&quot;/g,"\"");return s.replace(/&#(\d{2});/g,function($0,$1){return unescape("%"+parseInt($1).toString(16));});}
String.prototype.leftB=function(len){var s=this.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");return this.slice(0,s.slice(0,len).replace(/\*\*/g," ").replace(/\*/g,"").length);}
String.prototype.lenB=function(){return this.length;}
String.prototype.unHtmlLeftB=function(len){var newLen=len;while(newLen<=this.length&&this.substr(0,newLen).unHtmlReplace()!=this.unHtmlReplace().substr(0,len))
newLen++;return this.substr(0,newLen);}
String.prototype.htmlReplace=function(){return escHTML(this);return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;");}
String.prototype.getSpellArray=function(){if(!this.spellArray)
this.spellArray=new VBArray(GetSpell(this,false)).toArray();return this.spellArray;}
String.prototype.getSpell=function(){if(!this.spell)
this.spell=GetSpell(this,true);return this.spell;}
String.prototype.URIParam=function(){return this.trim().URIencode();}
var HelpDoc=(function(){var _status;var inner;return inner={toggle:function(){_status=!_status;var hd=$("help_doc");var hli=$("help_doc_img");if(_status){hd.style.display="";hli.className="shrink_icon";hli.alt="收缩";}else{hd.style.display="none";hli.className="spread_icon";hli.alt="展开";}},init:function(status){_status=status;inner.toggle();}}})();function getAlbums(){var albums;if(!(QZAPP.g_XDoc[16]&&(albums=XMLselectNodes(QZAPP.g_XDoc[16],"/data/album"))))return null;return QQShowFilter(albums);};function getAlbum(aid){var albums,idx;if((albums=getAlbums())==null)return null;if((idx=getIndexByValue(albums,"id",aid))==null)return null;return albums[idx];};function getPhotos(aid){var album,photos;if(!(album=getAlbum(aid)))return null;if(!(photos=XMLselectNodes(album,"pic")))return null;return photos;};function getPhoto(aid,lloc){var photos,idx;if(!(photos=getPhotos(aid)))return null;if((idx=getIndexByValue(photos,"lloc",lloc))==null)return null;return photos[idx];};function getRefer(){return(isQzone==true?"qzone":"portal");};function onModChange(s,max,o){var words=s.lenB();if(words>max)
words="<font color=red>"+words+"</font>";else
words="<font color=green>"+words+"</font>";o.innerHTML=words;};var Turner=(function(){var _total;var _index;var pager;var inner;function _buildPager(index){var start=Math.max(index-3,1);var end=Math.min(start+6,_total);start=Math.max(end-6,1);var result=[];for(var i=start;i<=end;i++){if((start>=2&&i==start)){result.push('<A class="bor2" href="javascript:Turner.turn2Page(1)">1</A> <STRONG class="ellipsis bor2">...</STRONG>');continue;}
if((end<=_total-1&&i==end)){result.push('<STRONG class="ellipsis bor2">...</STRONG><A class="bor2" href="javascript:Turner.turn2Page('+_total+')">'+_total+'</A> ');continue;}
result.push((i!=index)?'<a class="bor2" href="javascript:Turner.turn2Page('+i+')">'+i+'</a> ':'<strong class="c_tx bor2">'+i+'</strong>');}
var pre=$("turner_preview");var next=$("turner_next");var _s=[];if(index==1){_s.push("上一页");}else{_s.push('<a id="turner_preview" class="bor2 prev_page" href="javascript:Turner.turn2Preview();">上一页</a>');}
_s.push('<span id="page_list">'+result.join("")+' </span>');if(index==_total){_s.push("下一页");}else{_s.push('<a id="turner_next" class="bor2 next_page" href="javascript:Turner.turn2Next();">下一页</a>');}
(pre||next).parentNode.innerHTML=_s.join("");_index=index;QZONE.event.addEvent($("pageIndex"),"keydown",function(e){e=QZONE.event.getEvent(e);if(e.keyCode==13){inner.turn();}});}
return inner={init:function(total,index){var t=this;_total=total;pager=$("page_list");if(total>1){_buildPager(index);$show("page_turner");}else{$hide("page_turner");}},turn2Preview:function(){inner.turn2Page(_index-1);},turn2Next:function(){inner.turn2Page(_index-0+1);},turn2Page:function(index){if(_index==index){return;}
if(index<=0){QZFP.showMsgbox("当前页已经是第一页",3,1500);return;}
if(index>_total){QZFP.showMsgbox("当前页已经是最后一页",3,1500);return;}
_buildPager(index);inner.complete(_index-1);try{QZFP.setScrollTop(0);}catch(e){};refreshPing(2);},turn:function(){var index=parseInt($("pageIndex").value,10);if(isNaN(index)){QZFP.showMsgbox("请填入正确的页码!",3,1500)
return;}
if(index<=0||index>_total){QZFP.showMsgbox("此页码不存在!",3,1500)
return;}
inner.turn2Page(index);},refurbish:function(){var idx=_index;if(idx){_index=-1;inner.turn2Page(idx);}else{inner.complete(0);}},complete:function(index){PhotoList.change(index);}}})();var VersionInfo=(function(){var getMode=QZAPP.QZONE.space.getMode||function(){return 4;}
var inner;return inner={versionNum:function(){if(QZAPP.g_version&&QZAPP.g_version==5){return 5;}else if(QZAPP.g_version&&QZAPP.g_version==6){return 6;}
return 4;},isWider:function(){return(inner.versionNum()==5&&(getMode()==3||getMode()==4))||inner.versionNum()==6;},qzoneMode:function(){var vNum=VersionInfo.versionNum();var v;if(vNum==4){if(QZAPP.simpleMode){v=3;}else if(QZAPP.zoneMode=="qzone"){v=1;}else{v=2;}}else if(vNum==5){var mode=getMode();if(mode==0){v=1;}else if(mode==1||mode==2){v=2;}else{v=3;}}else{return 3;}
return v;}}})();function checkBigHead(){$show("bighead_tab");$("bighead_link")&&($("bighead_link").href='/qzone/mall/bighead/home.htm');}
function checkQQShow(){try{var xId=QZAPP.g_iUin+"_alist";var d=QZAPP.QZONE.dataCenter.get(xId);var albums=[];if(d&&d.album){albums=d.album;}else{albums=QZAPP.g_XDoc[16].selectNodes("/data/album");}
if(getIndexByValue(albums,"handset",4)!=null){$show("qqshow_tab");}else{$hide("qqshow_tab");}}catch(e){$hide("qqshow_tab");}}
function QQShowFilter(nodes){var result=[];for(var i=0;i<nodes.length;i++){if(parseInt(getNodeSubValue(nodes[i],"handset"),10)!=4){result.push(nodes[i]);}else{var albumName=getNodeSubValue(nodes[i],"name");albumName=albumName.replace(/(^\s*)|(\s*$)/g,"");if(albumName!="QQ秀相册"&&albumName!="QQ秀合影"&&albumName!="QQ秀形象"&&albumName!="QQ秀泡泡"&&albumName!="QQ秀形象_无背景")
result.push(nodes[i]);}}
return result;}
function checkInput(type,value){var len=value.lenB();switch(type){case"name":if(len<=0||value.match(/^\s*$/)){alert("名称不能为空，请输入名称")
return false;}
if(len>14){alert("请输入合适长度的名称,最多14个字符");return false;}break;case"spot_nick":if(len<=0||value.match(/^\s*$/)){alert("请先从好友列表选择所圈好友!");return false;}
if(len>16){alert("请输入合适长度的好友昵称,最多16个字符(8个汉字)");return false;}break;case"desc":if(len>150||len<0){alert("请输入合适长度的介绍,最多150个字符");return false;}break;case"tag":if(value.lenB()<1)break;value=value.replace(/，/g,",");var ss=value.split(",");if(ss.length>5){alert("单张照片最多只能设置5个TAG.");return false;}
for(var i=0;i<ss.length;i++){if(ss[i].lenB()>10){alert("单个tag最多10个字符");return false;}
if(ss[i].lenB()==0){alert("tag不能为空");return false;}}break;default:return true;}
return true;}
function setDivClassByMode(){var getMode=QZAPP.QZONE.space.getMode||function(){return 4;}
if((QZONE.FP._t.g_OFPLite||QZONE.FP._t.g_isLite)&&QZONE.FP.getQzoneConfig('version')!=6){QZFL.css.addClassName(document.body,'mod_simple');return;}
var div=document.getElementsByTagName("div")[0];if(div&&div.className.trim()=="photo"&&QPHOTO.inQzone){var miniClass="photo mini_mode_photo";var fullClass="photo full_mode_photo";var breadthClass="photo breadth_mode_photo";if(QZONE.FP._t.QZONE.dataCenter.get("photoEnvironmeng")=="myhome"){div.className=fullClass;return;}
var vNum=VersionInfo.versionNum();if(vNum==4){if(QZAPP.simpleMode){div.className=breadthClass;}else if(QZAPP.zoneMode=="qzone"){div.className=miniClass;}else{div.className=fullClass;}}else{var mode=getMode();if(mode==0){div.className=miniClass;}else if(mode==1||mode==2){div.className=fullClass;}else{div.className=breadthClass;}}}
if(QPHOTO.inPengyou){document.body.className='mod_pengyou';}}
function fixHeight(){}
function TSpeed(pid,p){var timePoints=[];timePoints[timePoints.length]=new Date()
this.SetTime=function(){timePoints[timePoints.length]=new Date();}
this.Report=function(rid,rp,rtps){if(rid)pid=rid;if(rp)p=rp;if(rtps)timePoints=rtps;if(Math.random()<p){var imgSendTimePoint,s=[]
for(var i=1;i<timePoints.length;i++){if(timePoints[i]){var dt=timePoints[i]-timePoints[0]||10;s.push(i+"="+dt);}}
var newType=false;if(200<pid&&pid<501){newType=true;}
var url="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1=177&flag2="+(newType?2:1)+"&flag3="+pid+"&"+s.join("&");imgSendTimePoint=new Image();imgSendTimePoint.src=url;}}
this.newReport=function(rid,rp,rtps){if(rid)pid=rid;if(rp)p=rp;if(rtps)timePoints=rtps;if(Math.random()<p){var imgSendTimePoint,s=[]
for(var i=1;i<timePoints.length-1;i++){if(timePoints[i]){s.push(i+"="+(timePoints[i]-timePoints[0]));}}
s.push(i+"="+timePoints[i]);var url="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1=177&flag2=1&flag3="+pid+"&"+s.join("&");imgSendTimePoint=new Image();imgSendTimePoint.src=url;}}}
function refreshPing(dt,ut){try{if(dt==3&&Math.random()<0.99){return;}
var domainMap={1:"photo.qzone.qq.com",2:"photoex.qzone.qq.com",3:"photoview.qzone.qq.com"}
var urlMap={1:location.pathname,2:"ISD.Qzone.Photo.ActivexSetupSucceed",3:"ISD.Qzone.Photo.ActivexSetupCancel",4:"ISD.Qzone.Photo.ViewOrigin",5:"ISD.Qzone.Photo.UploadWaterPress",6:"ISD.Qzone.Photo.ActivexSetupFailed",7:"ISD.Qzone.Photo.ActivexSetupUse"}
pvCurDomain=domainMap[dt]||domainMap[1];pvCurUrl=urlMap[ut]||urlMap[1];pgvMain();pvCurDomain=null;pvCurUrl=null;}catch(e){};}
function setCookie(name,value){document.cookie=name+"="+value+"; path=/; domain=qq.com";}
function parseTime(t){var ts=t.split(/\-|\s|\:/);for(var i=0;i<6;i++){if(typeof(ts[i]=parseInt(ts[i],10))!="number"){ts[i]=1;}}
var time=new Date(ts[0],ts[1]-1,ts[2],ts[3],ts[4],ts[5]);return Math.round(time.getTime()/1000);}
function checkNewPhoto(){$("newphoto_tab").style.display="";}
function clearNewPhoto(){QZAPP.ENV.set("refreshnewphoto",true);QZAPP.g_JData["new_photo_100"]=null;QZAPP.ENV.set("refreshnewphoto_1",true);}
function charTrim(str,len,needPostfix){var halflen=Math.floor(len/2);var result=[];var prefix;if(len&&str.getRealLength()>len){var prefix=str.substr(0,halflen);var curLen=prefix.getRealLength();var pad=str.substr(halflen);var a=pad.split("");var iLen=a.length;for(var i=0;i<iLen;i++){if((prefix+a[i]).getRealLength()>len){return(needPostfix?(prefix.substring(0,prefix.length-1)+"..."):prefix);}else{prefix+=a[i];}}
return(needPostfix?(prefix.substring(0,prefix.length-1)+"..."):prefix);}else{return str;}};function getFriAlbum(type){switch(type){case"time":return new FriTimeAlbum();case"user":return new FriUserAlbum();case"album":return new friAlbum();}}
var getVipStatus=function(){return QZFP.getBitMapFlag(27);};var isNVip=function(){return getVipStatus()?0:1;};function openVipPage(id){id=id||"zone.photo";window.open('http://pay.qq.com/qzone/index.shtml?ch=self&aid='+id+'&pageshow=bank&paytime=year&clientkey='+QZONE.cookie.get('zzpanelkey')+'&clientuin='+QZONE.cookie.get('zzpaneluin'));}
var User=User||{};User.isOwner=function(){return QPHOTO.user.isOwner();};function getUserDomain(callback,uin){setDfPolicyData();uin=uin||QPHOTO.user.getUin();var sucCb=function(){var data=QPHOTO.domain.getData({uin:uin});if(data){QZAPP.g_PhotoUserDomain=QZAPP.g_PhotoUserDomain||{};$extend(QZAPP.g_PhotoUserDomain,data);callback();}else{errCb();}};var errCb=function(){alert("对不起，服务器忙，请稍候再试！");QZAPP.guidebutton(1);};QPHOTO.domain.get({uin:uin,sucCb:sucCb,errCb:errCb});};function getDomainXml(isEncode){try{var data=QPHOTO.domain.getData({uin:QPHOTO.user.getUin()});var tmp=[]
for(var property in data){tmp.push(property+":"+data[property]);}
tmp="{"+tmp.join(",")+"}";if(isEncode==true){tmp=tmp.URIParam();}
return tmp}catch(e){return e.message;}};function getDomainUp(isEncode){try{var data=QPHOTO.domain.getData({uin:QPHOTO.user.getUin()});var tmp=data.u;if(isEncode==true){tmp=tmp.URIParam();}
return tmp}catch(e){return e.message;}};function getUrl(name,aid,uin){var errCb=function(){alert("对不起，服务器忙，请稍候再试！");QZAPP.guidebutton(1);return;}
uin=uin||QPHOTO.user.getUin();var url=QPHOTO.url.get({name:name,aid:aid,uin:uin,refer:getRefer()});if(url==null){errCb();}
return url;};function doCheckSessionUin(uin,needAlert,callBack,errBack){if(uin==QZAPP.g_iUin){return true;}else{if(typeof(errBack)=="function"){errBack();}else if(needAlert){alert("您还没有登录，请登录");}
QZONE.cookie.del("zzpaneluin","qq.com");QZAPP.QZONE.toolbar&&QZAPP.QZONE.toolbar.refresh&&QZAPP.QZONE.toolbar.refresh();window.LoginBack=function(){if(typeof(callBack)=="function"){callBack();}};QZFP.showLoginBox("photo");return false;}};function checkSessionUin(needAlert,callBack,errBack){var seUin=parseInt(QZONE.cookie.get("zzpaneluin"),10);if(isNaN(seUin)||seUin<1000){if(QPHOTO.inPengyou){seUin=QZAPP.checkLogin()||0;}else{seUin=parseInt(QZONE.cookie.get("uin").replace(/[^\d]/g,""),10);if(isNaN(seUin)||seUin<1000){seUin=0;}}}
return doCheckSessionUin(seUin,needAlert,callBack,errBack);};function XMLDocInt(){Node.prototype.swapNode=function(node){var nextSibling=this.nextSibling;var parentNode=this.parentNode;node.parentNode.replaceChild(this,node);parentNode.insertBefore(node,nextSibling);};HTMLElement.prototype.__defineSetter__("innerText",function(sText){var parsedText=document.createTextNode(sText);this.innerHTML=parsedText;return parsedText;});HTMLElement.prototype.__defineGetter__("innerText",function(){var r=this.ownerDocument.createRange();r.selectNodeContents(this);return r.toString();});XMLDocument.prototype.__proto__.__defineGetter__("xml",function(){var e;try{return new XMLSerializer().serializeToString(this);}catch(e){var d=document.createElement("div");d.appendChild(this.cloneNode(true));return d.innerHTML;}});Element.prototype.__proto__.__defineGetter__("xml",function(){var e;try{return new XMLSerializer().serializeToString(this);}catch(e){var d=document.createElement("div");d.appendChild(this.cloneNode(true));return d.innerHTML;}});XMLDocument.prototype.__proto__.__defineGetter__("text",function(){return this.firstChild.textContent;});Element.prototype.__proto__.__defineGetter__("text",function(){return this.textContent;});XMLDocument.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(xpath){var x=this.selectNodes(xpath)
if(!x||x.length<1)return null;return x[0];};XMLDocument.prototype.selectNodes=Element.prototype.selectNodes=function(xpath){var xpe=new XPathEvaluator();var nsResolver=xpe.createNSResolver(this.ownerDocument==null?this.documentElement:this.ownerDocument.documentElement);var result=xpe.evaluate(xpath,this,nsResolver,0,null);var found=[];var res;while(res=result.iterateNext())
found.push(res);return found;};XMLDocument.prototype.getOuterXML=Element.prototype.getOuterXML=function(){var e;try{return new XMLSerializer().serializeToString(this);}catch(e){var d=document.createElement("div");d.appendChild(this.cloneNode(true));return d.innerHTML;}};CSSStyleSheet.prototype.addRule=function(selectorText,cssText,index){return this.insertRule(selectorText+cssText,index);};CSSStyleSheet.prototype.removeRule=CSSStyleSheet.prototype.deleteRule
HTMLElement.prototype.__defineGetter__("currentStyle",function(){return window.getComputedStyle(this,"");});}
if(ua.firefox||ua.chrome||ua.safari){XMLDocInt();}
function getXMLDOM(){if(!Browser.isIE)return null;var xmldomversions=['MSXML2.DOMDocument.5.0','MSXML2.DOMDocument.4.0','MSXML2.DOMDocument.3.0','MSXML2.DOMDocument','Microsoft.XMLDOM'];for(var i=xmldomversions.length-1;i>=0;i--)
try{return new ActiveXObject(xmldomversions[i]);}catch(e){}
return null;}
function parseXML(st){if(Browser.isIE){var result=getXMLDOM();result.loadXML(st);}else{var parser=new DOMParser();var result=parser.parseFromString(st,"text/xml");}
return result;}
XMLselectSingleNode=function(o,xpath){var result;try{result=o.selectSingleNode(xpath);}catch(e){var x=XMLselectNodes(o,xpath)
if(!x||x.length<1){result=null;}else{result=x[0];}}
return result;};XMLselectNodes=function(o,xpath){var result;try{result=o.selectNodes(xpath);}catch(e){var xpe=new XPathEvaluator();var nsResolver=xpe.createNSResolver(o.ownerDocument==null?o.documentElement:o.ownerDocument.documentElement);var result=xpe.evaluate(xpath,o,nsResolver,0,null);var found=[];var res;while(res=result.iterateNext()){found.push(res);}
result=found;}
return result;};var photoPreLoadNum=1;var photoPreType;var doSendPhotoPre=false;function sendPhotoPreReq(type){var tMap={"photo":1,"new":2,"fri":3,"info":4}
if(Math.random()<=0.05&&doSendPhotoPre){if(!QZAPP._photoStaticImg){QZAPP._photoStaticImg=new QZAPP.Image();}
QZAPP._photoStaticImg.src="http://isdspeed.qq.com/cgi-bin/v.cgi?flag1=9008&flag2="+tMap[type]+"&1="+photoPreLoadNum;}
if(doSendPhotoPre){photoPreLoadNum=1;}}
function getFriPhotoRandomSeed(){return QZAPP.fri_pic.randomSeed;}
function getFriPhotoReqStatus(){return QZAPP.fri_pic.reqStatus;}
function setFriPhotoReqFriData(){var nt=(new Date()).getTime();if(!QZAPP.fri_pic){QZAPP.fri_pic={};QZAPP.fri_pic.reqTime=nt;QZAPP.fri_pic.reqStatus=true;QZAPP.fri_pic.randomSeed=nt;}else if(nt-QZAPP.fri_pic.reqTime>=2*60*60*1000){QZAPP.fri_pic.reqTime=nt;QZAPP.fri_pic.reqStatus=true;QZAPP.fri_pic.randomSeed=nt;}else{QZAPP.fri_pic.reqStatus=false;}}
function sendFriStatic(domain,url){pvCurDomain=domain;pvCurUrl=url;pgvMain();pvCurDomain=null;pvCurUrl=null;}
function sendFriSpeedReport(type,timeList){var map={"friend_photo_list_time":32,"friend_photo_list_fri":31,"friend_photo_list_album":33,"friend_photo_list":34,"album_photo_list":35}
new TSpeed().Report(map[type],0.1,timeList);}
function getPhotoPolicy(cb){if(!QZAPP.routeTime){QZAPP.routeTime=(new Date()).getTime();}else{var t=new Date();if(t.getTime()-QZAPP.routeTime>15*60*1000){QZAPP.routeTime=t.getTime();}else{if(QZAPP.photoPolicyData.viewright==2){alert("对不起，服务器忙，请稍候再试！");QZAPP.guidebutton(1);return;}else{cb();return;}}}
var callBack=function(){var data=QZAPP.g_JData["photo_policy"];if(data.systime){QZAPP.photoPolicyData.systime=data.systime;if(typeof data.service.recode!="undefined"){}else{var _get=function(s){var rt={};try{var d=s.split("-");for(var i=0;i<d.length;i++){rt[d[i]]=true;}}
catch(e){};return rt;}
var _d={systime:data.systime,stamp:data.service.timestamp,level:data.service.level,timelimit:(function(){if(data.service.timegap==0){return 0;}
var limit;var time=data.service.timegap.split("-");return limit={start:time[0],end:time[1]}})(),preview:data.service.preview,signpic:data.service.signpic,bigview:data.service.bigview,viewright:data.service.viewright,set:_get(data.service.set),idc:_get(data.service.idc),domain:(function(_d){if(!_d){return null;}
var result={};var _v=_d.split(";");for(var i=0,l=_v.length;i<l;i++){_k=_v[i].split(":");result[_k[0]]=_k[1];}
return result;})(data.service.domain)}
for(var i in _d){QZAPP.photoPolicyData[i]=_d[i];}}}
if(QZAPP.photoPolicyData.viewright==2){alert("抱歉，因网络故障，相册暂时无法查看。");QZAPP.guidebutton(1);}else{cb();}}
var errBack=function(){if(state=="static"){state="dynamic";var url="http://pb.store.qq.com/GetPolicy?UIN="+QZAPP.g_iUin+"&visitor="+QZAPP.g_iLoginUin+"&visitorstatus=0&type=json&timestamp="+QZAPP.photoPolicyData.timestamp+"&t="+QZAPP.routeTime;QPHOTO.util.loadJsonData("photo_policy",url,callBack,errBack,true,"gb2312","photoDomainNameCallback");}else{if(QZAPP.photoPolicyData.viewright==2){alert("抱歉，因网络故障，相册暂时无法查看。");QZAPP.guidebutton(1);}else{cb();}}}
var state="static";var url="http://policy.store.qq.com/GetPolicy?UIN="+QZAPP.g_iUin+"&visitor="+QZAPP.g_iLoginUin+"&visitorstatus=0&type=json&timestamp="+QZAPP.photoPolicyData.timestamp+"&t="+QZAPP.routeTime;QPHOTO.util.loadJsonData("photo_policy",url,callBack,errBack,true,"gb2312","photoDomainNameCallback");}
function isBusyTime(isRepeat){try{if(typeof QZAPP.photoPolicyData.timelimit.start=="undefined"){return false;}
var t=new Date(QZAPP.photoPolicyData.systime*1000);var start=QZAPP.photoPolicyData.timelimit.start.split(":");var end=QZAPP.photoPolicyData.timelimit.end.split(":");var tStart=new Date(t.getFullYear(),t.getMonth(),t.getDate(),start[0],start[1]);var tEnd=new Date(t.getFullYear(),t.getMonth(),t.getDate(),end[0],end[1]);if(t.getTime()<=tEnd.getTime()&&t.getTime()>=tStart.getTime()){return true;}
return false;}catch(e){setDfPolicyData();if(!isRepeat){return isBusyTime(true);}
return false;}}
function isLimitSet(src){try{var m=src.match(/b([0-9][0-9]*)(.)photo/);if(QZAPP.photoPolicyData.set[m[1]]){return true;}
return false;}catch(e){return false;}}
function dataSender(url,data,sucCb,errCb){var arg=arguments;data["output_type"]="jsonhtml";data["refer"]=QPHOTO.refer;data["plat"]=QPHOTO.plat;if(!data["uin"]){data["uin"]=QZFP.checkLogin();}
var post=new QZFL.FormSender(url,"post",data,"gb2312");post.onSuccess=function(d){var ret=d.ret;var msg=d.msg;if(d.data){ret=d.data.code;msg=d.data.msg;}
if(ret==0){sucCb(d);}else if(ret==-900){window.LoginBack=function(){arg.callee.apply(null,arg);};QZONE.FP.showLoginBox("photo",null,null,{"mode":1});}else{QZFP.showMsgbox(msg,5,2000);if(typeof errCb=="function"){errCb(d);}}}
post.onError=function(d){QZFP.showMsgbox("对不起，网络繁忙，请稍后再试！",5,2000);if(typeof errCb=="function"){errCb(d);}}
post.send();}
function setDfPolicyData(){if(!QZAPP.photoPolicyData){QZAPP.photoPolicyData=new QZAPP.Object();QZAPP.photoPolicyData.systime=QZAPP.g_NowTime||((new Date()).getTime()/1000);QZAPP.photoPolicyData.level=1;QZAPP.photoPolicyData.bigview=0;QZAPP.photoPolicyData.idc={};QZAPP.photoPolicyData.preview=0;QZAPP.photoPolicyData.retcode=0;QZAPP.photoPolicyData.set={};QZAPP.photoPolicyData.signpic=0;QZAPP.photoPolicyData.timestamp=0;QZAPP.photoPolicyData.timelimit={start:"18:30",end:"22:30"};QZAPP.photoPolicyData.viewright=0;QZAPP.photoPolicyData.domain=null;}}
function changeTagName(){try{QZONE.event.removeEvent(window,"load",changeTagName);var tag=$("album_link");if(User.isOwner()){tag.innerHTML=tag.innerHTML.replace(/.*相册/,"我的相册");}else{tag.innerHTML=tag.innerHTML.replace(/.*相册/,"主人相册");}}catch(e){}}
if(QZONE.pageEvents&&QZONE.pageEvents.pageBaseInit){QZONE.pageEvents.pageBaseInit();QZONE.pageEvents.onloadRegister(changeTagName);}else{QZONE.event.addEvent(window,"load",changeTagName);}
function checkLoginUserStatus(callBack){if(QZFP.checkLogin()){if(QZAPP.g_iLoginUin!=QZAPP.g_iUin){QZONE.FP.getLoginUserBitMap(callBack,1);}}}
function showLog(mao,value){if(value==0){$show("user_log_hint_0");}}
function loadJs(url,sucCb,errCb,charset){var l=new QZFL.JsLoader();if(typeof sucCb=="function"){l.onload=sucCb;}
if(typeof errCb=="function"){l.onerror=errCb;}
l.load(url,null,(charset||"utf-8"));};var Cmt=(function(){function _get(type,uin,id,lloc,flag,isForce){switch(type){case 1:MyCmt=new PhotoCmt(uin,id,lloc,flag);break;case 2:MyCmt=new NewPhotoCmt(uin,id,lloc,flag);break;case 3:MyCmt=new FriPhotoCmt(uin,id,lloc,flag);break;case 4:MyCmt=new FlashCmt(uin,id,flag);break;}
Timer.relax(_load,2000);if(isForce){setTimeout(QzsEditor.contentFocus,100);}}
function _load(){MyCmt.get();}
var inner;return inner={init:function(type,uin,id,lloc,flag,isForce){function _g(){setTimeout(_get.pass(type,uin,id,lloc,flag,isForce),100);}
if(typeof MyCmt!="undefined"){_g();return;}
if(!(flag||isForce)){checkLoginUserStatus(showLog);return;}
loadJs("/qzone/client/photo/pages/qzone_v4/script/comment.js",_g);}}})();function dataLoader(xid,url,data,sucCb,errCb,refresh){function _suc(d){if(d.ret==0){if(typeof sucCb=="function"){sucCb(d);}}else{QPHOTO.g_JData[xID]=null;delete QPHOTO.g_JData[xID];_err(d);}}
function _err(d){if(typeof errCb=="function"){d=d||{};errCb(d);}}
data=data||{};data["output_type"]="json";if(!url.match(/refer\=/)){data["refer"]="qzone";}
if(!(data["uin"]||url.match(/uin\=/))){data["uin"]=QZFP.g_iUin;}
var p=[];for(var i in data){p.push(i.URIParam()+"="+(data[i]+"").URIParam());}
if(url.match(/\?/)){url+="&"+p.join("&");}else{url+="?"+p.join("&");}
QPHOTO.util.loadJsonData(xid,url,_suc,_err,refresh,"gb2312","_Callback");};var Mak=(function(){function _get(type,uin,aid,lloc,flag,img){switch(type){case 1:MyMak=new PhotoMak(uin,aid,lloc,flag,img);break;case 2:MyMak=new Marked(uin,aid,lloc,flag,img);break;case 3:MyMak=new FirPhotoMak(uin,aid,lloc,flag,img);break;}
MyMak.get();}
var inner;return inner={get:function(type,uin,aid,lloc,flag,img){flag=parseInt(flag,10);function _g(){setTimeout(_get.pass(type,uin,aid,lloc,flag,img),100);}
if(typeof MyMak!="undefined"){_g();return;}
if(!flag){var html="圈圈： <span>还没有添加圈圈</span>";if(type==1){html=['圈圈： ','<a href="javascript:void(0);" onclick="Page.markedPhoto();return false;" class="author-display" title="圈出照片中的她\\他\\它">点此添加圈圈</a>','<span class="visitor-display">还没有添加圈圈</span>'].join("");}
setTimeout(function(){},0);return;}
loadJs("/qzone/client/photo/pages/qzone_v4/script/marked.js",_g);},add:function(type,uin,aid,lloc,flag,img){if(typeof MyMak!="undefined"){DrawMarked.init(uin,aid,lloc,flag,img);return;}
loadJs("/qzone/client/photo/pages/qzone_v4/script/marked.js",function(){_get(type,uin,aid,lloc,flag,img);DrawMarked.init(uin,aid,lloc,flag,img);});}}})();function enterNoboderFrame(src,callBack){var _lastTween=QZONE.FP._t.QZFL.dialog.tween;QZONE.FP._t.QZFL.dialog.tween=false
var w=QZONE.FP._t.QZFL.dom.getClientHeight()+"px";QZONE.FP._t.photoDialog=QZONE.FP._t.QZFL.dialog.createBorderNone('<iframe frameborder="no" name="photoDialgIfm" id="photoDialgIfm" style="width:100%;height:'+w+'" src="'+src+'"></iframe>',QZFP._t.QZFL.dom.getClientWidth()+30,QZFP._t.QZFL.dom.getClientHeight());function t(){QZONE.FP._t.$("photoDialgIfm").style.height=QZONE.FP._t.QZFL.dom.getClientHeight()+"px";QZONE.FP._t.$("photoDialgIfm").style.width=QZONE.FP._t.QZFL.dom.getClientWidth()+"px";try{QZONE.FP._t.frames("photoDialgIfm").document.body.style.width=QZONE.FP._t.QZFL.dom.getClientWidth()+"px";QZONE.FP._t.frames("photoDialgIfm").document.body.style.width=QZONE.FP._t.QZFL.dom.getClientHeight()+"px";}catch(e){};}
QZFL.event.addEvent(QZONE.FP._t,"resize",t);QZONE.FP._t.photoDialog.onUnload=function(){QZFL.event.removeEvent(QZONE.FP._t,"resize",t);if(typeof callBack=="function"){try{callBack(QZONE.FP._t.photoDialog);}catch(e){}}
QZONE.FP._t.photoDialog=null;QZONE.FP.toggleDisplay(true,"thpfsr");QZONE.FP._t.QZFL.dialog.tween=_lastTween;}
setTimeout(function(){QZONE.FP.toggleDisplay(false,"thpfsr");},0);}
function displayCustomSlideInQzone(albumData,aid,fid,cb,bPreview){QZONE.FP._t.personalDisplayConf={"data":formatPhoto(albumData||PhotoList.getAlbum(aid)),"exInfo":getAlbumMusicInfo((albumData||PhotoList.getAlbum(aid)))}
var data=["uin="+QZFP.g_iUin,"a_id="+aid,"fid="+fid,"viewtype="+(bPreview?"preview":""),"priv="+(getNodeSubValue(albumData||PhotoList.getAlbum(aid),"priv"))].join("&");var _cb=function(dlg){switch(QZONE.FP._t.personalDisplayConf.conmand){case 1:if(cb){try{setTimeout(cb,0);}catch(e){}}
break;case 2:if(cb){try{pvCurDomain="diyphoto.qzone.qq.com";pvCurUrl="putong";pgvMain();pvCurDomain=null;pvCurUrl=null;setTimeout(cb,0);}catch(e){}}else{if(/photo_list.htm/.test(location.href)){pvCurDomain="diyphoto.qzone.qq.com";pvCurUrl="putong";pgvMain();pvCurDomain=null;pvCurUrl=null;}
QZONE.FP._t.QZFL.dataCenter.save("listnormalview",true);qz_go_imc("photo_list.htm",QZONE.FP._t.personalDisplayConf.aid,null,"from=swf");}
break;case 3:if(/personal_album.html/.test(location.href)){pvCurDomain="diyphoto.qzone.qq.com";pvCurUrl="qita";pgvMain();pvCurDomain=null;pvCurUrl=null;if(cb){setTimeout(cb,0);break;}}
qz_go_imc("personal_album.html",QZONE.FP._t.personalDisplayConf.aid,null,"from=swf");break;case 4:QZONE.FP._t.QZFL.dataCenter.save("listnormalview",true);qz_go_imc("photo_list.htm",QZONE.FP._t.personalDisplayConf.aid,null,"from=swf");break;default:qz_go_imc("album_list.htm");}};enterNoboderFrame("/qzone/client/photo/pages/qzone_v4/char_album.html#"+data,_cb);}
function XMLGetNodeValue(node,path){try{if(Browser.isIE||node.selectSingleNode){return node.selectSingleNode(path).text.replace(/^\n|\n$/,"")||node.selectSingleNode(path).firstChild.nodeValue;}else if(XPathEvaluator){return XMLselectSingleNode(node,path).textContent;}}catch(e){}
return null;}
function formatPhoto(data){var result={photos:[]};var nodes=data.getElementsByTagName("pic");for(var i=0;i<nodes.length;i++){result.photos.push({lloc:XMLGetNodeValue(nodes[i],"lloc"),name:XMLGetNodeValue(nodes[i],"name"),pre:XMLGetNodeValue(nodes[i],"pre"),desc:XMLGetNodeValue(nodes[i],"desc"),url:XMLGetNodeValue(nodes[i],"url"),origin_url:XMLGetNodeValue(nodes[i],"origin_url"),height:XMLGetNodeValue(nodes[i],"height"),width:XMLGetNodeValue(nodes[i],"width"),sloc:XMLGetNodeValue(nodes[i],"sloc"),forum:XMLGetNodeValue(nodes[i],"forum"),uploadtime:XMLGetNodeValue(nodes[i],"uploadtime"),browser:XMLGetNodeValue(nodes[i],"browser")})}
return result;}
function getAlbumMusicInfo(data){return{"songurl":(restHTML(XMLGetNodeValue(data,"songurl"))),"songid":XMLGetNodeValue(data,"songid"),"songtype":XMLGetNodeValue(data,"songtype"),"songname":(restHTML(XMLGetNodeValue(data,"songname"))),"singername":(restHTML(XMLGetNodeValue(data,"singername")))}}
function regPhotoClickStream(rulesFileUrl,opt){opt=opt||{};opt.sampleRate=opt.sampleRate||1;opt.doc=opt.doc||document;return QZONE.FP.regClickStream?QZONE.FP.regClickStream(rulesFileUrl,opt):false;}
function checkFriendPhoto(){if(QZAPP.g_iUin==QZAPP.g_iLoginUin){$("friend_tab").style.display="";}}
function getUserCreditDegree(islogin,cb){var map={1:"A",2:"B1",0:"B2",3:"B3",4:"C1",5:"C2",6:"C3",7:"D"}
var level=QZONE.FP._t.QZONE.FrontPage.getCrediteLevel(islogin);cb(map[level]);}
function loadJs(url,sucCb,errCb,charset){var l=new QZFL.JsLoader();if(typeof sucCb=="function"){l.onload=sucCb;}
if(typeof errCb=="function"){l.onerror=errCb;}
l.load(url,null,(charset||"utf-8"));};function checkVideoAlbum(){loadJs("/qzone/photo/video/js/nav_data.js",function(){videoAlbumNav(function(num){if(num!=-1){$("video_tab").style.display="";}});},function(){})}
(function(){this.MicroBlog={"getStatus":function(callback){var url="http://r.qzone.qq.com/cgi-bin/right/get_qqbitmap.cgi";var data={"uin":QZONE.FP.getQzoneConfig().loginUin,"t":Math.random()}
var snd=new QZFL.JSONGetter(url,void(0),data,"gb2312");snd.onSuccess=function(o){callback(o);};snd.onError=function(){callback({"items":[{"ugcphoto":-1}]})};snd.send("_Callback");},"setStatus":function(bSynchronize,callback){var url="http://"+(QPHOTO.inPengyou?'w.pengyou.com':'w.qzone.qq.com')+"/cgi-bin/right/set_qqbitmap.cgi";var data={"uin":QZONE.FP.getQzoneConfig().loginUin,"ugcphoto":(bSynchronize?1:-1)}
var post=new QZFL.FormSender(url,"post",data,"gb2312");post.onSuccess=function(o){callback(o)}
post.onError=function(){callback({"error":"error","msg":"空间更新同步微博设置失败"})}
post.send();},"initStatus":function(parentNode){var g_iRadioNo=4*QZONE.FP.getBitMapFlag(11)+2*QZONE.FP.getBitMapFlag(10)+QZONE.FP.getBitMapFlag(9);if(QZONE.FP.getBitMapFlag(41)&&(g_iRadioNo==0)){parentNode=parentNode||$("sync_micro").parentNode;parentNode.style.display="";MicroBlog.getStatus(function(o){if(o.error){}else if(o.items){if(o.items[0]){if(o.items[0].ugcphoto==1){$("sync_micro").checked=true;}else{$("sync_micro").checked=false;}}else{}}})
bindEvent();}}}
function bindEvent(){$e("#sync_micro").onClick(function(){var st=this.checked;MicroBlog.setStatus((st?true:false),function(o){if(o.error){QZONE.FP.showMsgbox(o.msg,5,2000);this.checked=!st;}});})}})();﻿var SpeedReport=(function(){var inner;return inner={sendBigReport:function(st,rt,src,size){var m=src.match(/b([0-9]+)\.photo\.store\.qq\.com/)
if(size!=-1&&m){var v=size/(rt-st);var d=parseInt(m[1],10);if(rt-st>200){new TSpeed().Report(300+d,0.01,[st,rt]);new TSpeed().Report(400+d,0.01,[0.0000001,v]);}}},sendSmallReport:function(st,rt,src){var m=src.match(/a([0-9]+)\.photo\.store\.qq\.com/);if(m){var d=parseInt(m[1],10);new TSpeed().Report(200+d,0.002,[st,rt]);}}}})();var Img=(function(){var scaleVar=1000;function _adjust(img,width,height,bSplit){if(img.width<width&&img.height<height){return;}
var mode=img.height*width>img.width*height?1:2;if(bSplit){mode=mode==1?2:1;}
switch(mode){case 2:img.height=Math.round(img.height*width*scaleVar/img.width)/scaleVar;img.width=width;break;case 1:img.width=Math.round(img.width*height*scaleVar/img.height)/scaleVar;img.height=height;break;}}
function vMiddle(img,tH,rH){if(tH>rH){img.style.marginTop=Math.round((tH-rH)/2)+"px";}}
function hMiddle(img,tW,rW){if(rW>tW){img.style.marginLeft=-Math.round((rW-tW)/2)+"px";}}
var inner;return inner={preLoad:function(obj,src,width,height,mode,needStatistic,type){width=width||100;height=height||100;var mode=mode||0;var img=new Image();img.onload=function(){var loadTime=new Date();if(needStatistic){switch(type){case"small":SpeedReport.sendSmallReport(startTime,loadTime,src)
break;case"big":SpeedReport.sendBigReport(startTime,loadTime,src,this.fileSize);break;}}
this.onload=null;_adjust(this,width,height,mode);obj.src=this.src;obj.style.width=this.width+"px";obj.style.height=this.height+"px";obj.style.display="";if(height>this.height){vMiddle(obj,height,this.height);}
if(this.width>width){}
fixHeight();}
img.onerror=function(){this.onerror=null;this.src='/qzone_v4/client/userinfo_icon/5001.gif';}
var startTime=new Date();img.src=src;},widthLimit:function(obj,src,width,needStatistic,type,cb){width=width||(VersionInfo.isWider()?880:700);var img=new Image;img.onload=function(){var loadTime=new Date();if(needStatistic){switch(type){case"small":SpeedReport.sendSmallReport(startTime,loadTime,src);break;case"big":SpeedReport.sendBigReport(startTime,loadTime,src,this.fileSize);break;}}
this.onload=null;_adjust(this,width,this.height);obj.src=this.src;obj.style.width=this.width+"px";obj.style.height=this.height+"px";obj.style.display="";fixHeight();if(typeof cb=="function"){cb();}}
var startTime=new Date();img.src=src;},adjust:_adjust,adjustSize:function(width,height,maxWidth,maxHeight){w=parseInt(width,10);h=parseInt(height,10);var size={w:w,h:h};var mW=maxWidth||w;var mH=maxHeight||h;if(w<=mW&&h<=mH){return size;}
if(w*mH>h*mW){size.w=mW;size.h=Math.round(h*mW*scaleVar/w)/scaleVar;}else{size.w=Math.round(w*mH*scaleVar/h)/scaleVar;size.h=mH;}
return size;}}})();var ImgLoader=(function(){var _map={};var _key;function _isFree(o){if(o.free||o.readyState=="complete"){return true;}
return false;}
function _purge(o){o.onload=null;o.loadFn=QPHOTO.emptyFn;QZONE.event.purgeEvent(o,"load");QZONE.event.purgeEvent(o,"error");QZONE.event.purgeEvent(o,"click");QZONE.event.purgeEvent(o,"mousemove");QZONE.event.purgeEvent(o,"readystatechange");}
function _getFree(){var k;for(var p in _map){if(_map[p]&&p!=_key){k=p;if(_isFree(_map[p])){k=p;break;}}}
_purge(_map[k]);return k;}
function _load(attr){var o,k;if(!(attr&&attr.src)){return false;}
function onLoad(e){QZONE.event.purgeEvent(o,"load");o.free=true;o.loadFn();}
function onError(){QZONE.event.removeEvent(o,"load",onError);o.free=true;}
var url=attr.src;function replace(){QZONE.event.purgeEvent(o,"error");QZONE.event.purgeEvent(o,"load");QZONE.event.addEvent(o,"load",onLoad);QZONE.event.addEvent(o,"error",onError);o.src=url;}
if(!(o=_map[url])){k=_getFree();o=_map[k];o.free=false;if(!ua.ie){QZONE.event.addEvent(o,"load",replace);QZONE.event.addEvent(o,"error",replace);o.src="/ac/b.gif";}else{replace();}
_map[url]=o;delete(_map[k]);}else{_purge(o);QZONE.event.addEvent(o,"load",onLoad);QZONE.event.addEvent(o,"error",onError);}
for(var p in attr){if(/load/.test(p)){o.loadFn=(function(p){return function(){o.free=true;QZONE.event.purgeEvent(o,"load");QZONE.event.purgeEvent(o,"error");attr[p](QZONE.event.getEvent(),o);}})(p)}else if(typeof attr[p]=="function"){QZONE.event.addEvent(o,p,attr[p],[o]);}else if(/class/.test(p)){o.className=attr[p];}else if(/style/.test(p)){o.style.cssText=attr[p];}else if(!/src/.test(p)){o[p]=attr[p];}}
if(_isFree(o)){o.loadFn();}
return o;}
var inner;return inner={init:function(container,num,attr){num=num||5;attr=attr||{};QPHOTO.setDef(attr,"src","about:blank");QPHOTO.setDef(attr,"style","display:none");QPHOTO.setDef(attr,"free",true);for(var i=0;i<num;i++){attr.id="photo_img"+i;_map[i]=QZONE.dom.createElementIn("img",container,false,attr);}
_lt=new Date();},show:function(attr){var old=_map[_key];if(old){$hide(old);_purge(old);}
var o=_load(attr);function display(){QZONE.event.removeEvent(o,"readystatechange",display);$show(o);}
if(_isFree(o)||o.readyState!="uninitialized"||!ua.ie){display();}else{QZONE.event.addEvent(o,"readystatechange",display);}
_key=attr.src;return o;},prep:function(attr){return _load(attr);},load:function(attr,pAttr){var o=inner.show(attr);inner.prep(pAttr);return o;}}})();var Tpl=(function(){var typeMap={}
var typeIconMap={0:"",1:"mobile_album",2:"affix_album",3:"",4:"qqshow_album",5:"xiaoyou_album"}
var privMap={1:"公开",2:"密码访问",3:"仅主人可见"}
var privIconMap={1:"icon_photo_publicity",2:"icon_photo_secret",3:"icon_photo_encrypt"}
var cmtTypeMap={0:"评论",1:"相册",2:"圈圈",3:"评论"}
var markedStatusMap={0:"公开",1:"隐藏"}
var classMap={101:"人物",102:"风景",103:"动物",104:"游记",105:"卡通",106:"生活",107:"其他"}
var classOld2NewMap={61:101,62:101,63:101,64:101,65:101,66:101,71:106,72:106,73:106,74:103,75:105,76:105,81:102,82:104,83:105,84:104,85:105,86:102,91:107,92:107,93:107,94:102,95:102,96:107}
function _formatTypeIcon(type){type=parseInt(type,10);return typeIconMap[type];}
function _formatPrivDesc(priv){return privMap[priv-0];}
function _formatPrivIcon(priv){return privIconMap[priv-0];}
function _formatTag(tag){return(tag?tag:"aaa"+"test");}
function _formatCmtType(type){type=type-0;return cmtTypeMap[type];}
function _formatMarkedStatus(status){status=status-0;return markedStatusMap[status];}
function _reverseMarkedStatus(status){status=(status-0)?0:1;return markedStatusMap[status];}
function _formatClass(type){type=parseInt(type,10);if(type<97)type=classOld2NewMap[type];if((!type)||type<101||type>107)type=107;return classMap[type];}
function _config(conf,value){if(conf.ubb){value=ubbReplace(value+"","face");}
if(conf.n&&conf.compress){value=value.replace(/(<br>)+/ig,"<br/>")}
return value;}
function charTrim(str,len,needPostfix){var halflen=Math.floor(len/2);var result=[];var prefix;if(len&&getRealLen(str)>len){var prefix=str.substr(0,halflen);var curLen=getRealLen(prefix);var pad=str.substr(halflen);var a=pad.split("");var iLen=a.length;for(var i=0;i<iLen;i++){if(getRealLen(prefix+a[i])>len){return(needPostfix?(prefix.substring(0,prefix.length-1)+"..."):prefix);}else{prefix+=a[i];}}
return(needPostfix?(prefix.substring(0,prefix.length-1)+"..."):prefix);}else{return str;}};function _formatMarkedTips(content){return charTrim(content,14,true);}
function _getReplyClass(uin){if(uin==QZFP.checkLogin()){return" ";}else if(QZAPP.g_iUin==QZAPP.g_iLoginUin){return" ";}else{return"none";}}
function _getFriReplyClass(uin){if(uin==QZFP.checkLogin()){return" ";}else{return"none";}}
function _getPerAlbumLiClass(id){if(parseInt(id,10)&&QZONE.FP.getVipStatus()){return"personalized";}
return"";}
function _getPerAlbumIconClass(id){if(parseInt(id,10)&&QZONE.FP.getVipStatus()){return"personalized_album_mark";}
return"";}
function _getPerAlbumNormClass(id){if(parseInt(id,10)&&QZONE.FP.getVipStatus()){return"display:"}
return"display:none;"}
function _showTagList(t){t=t.replace(/\s{0,1}$/,"");t=t.replace(/，/g,",").replace(/,\s*,/g,",").replace(/^\s*,|,\s*$/,"");;if(t.match(/^\s*$/))
return"";return t.replace(/,/g," ");}
function _showEditAlbumDescIcon(v){var s;if(s=v.replace(/\s{0,1}$/,"")){if(s.getRealLength()>=10){return"<br>编辑描述";}
return"编辑描述";}
else{return"点此输入相册描述";}}
function _showEditAlbumNameIcon(v){var s;if(s=v.replace(/\s{0,1}$/,"")){if(s.getRealLength()>=10){return"<br>编辑名称";}
return"编辑名称";}
else{return"点此输入相册名称";}}
function _showEditPhotoDescIcon(v){var s;if(s=v.replace(/\s{0,1}$/,"")){if(s.getRealLength()>23){return"<br>编辑描述";}
return"编辑描述";}else{return"点此输入照片描述";}}
function _showEditPhotoTagIcon(v){var s;if(s=v.replace(/\s{0,1}$/,"")){if(s.getRealLength()>40){return"<br>编辑标签";}
return"编辑标签";}else{return"点此输入标签";}}
function _showVisitorPhotoDesc(v){if(!v.replace(/\s{0,1}$/,""))
v="还没有照片描述";return v;}
function _showVisitorPhotoTag(v){if(!v.replace(/\s{0,1}$/,""))
v="还没有标签";return v;}
function _showEditVphotoDescIcon(v){var s;if(s=v.replace(/\s{0,1}$/,"")){if(s.getRealLength()>32){return"<br>编辑描述";}
return"编辑描述";}else{return"点此添加影集描述";}}
function _showVisitorVphotoDesc(v){if(!v.replace(/\s{0,1}$/,""))
v="还没有影集描述";return v;}
function _formatCoverTips(desc){desc=desc.trim();var result="";if(desc.length>14){result+=desc.substring(0,14)+"\n";if(desc.length>28){result+=desc.substring(14,27)+"...";}else{result+=desc.substring(14);}}else{result+=desc;}
return result;}
function _wordLen(v){return v.lenB();}
function _ubbText(v){try{v=v.replace(/\n/g,"").replace(/\[em\]e(\d{1,3})\[\/em\]/g,function(){return"\\"+g_emText[arguments[1]-100];});return v;}catch(e){};return v;}
function _formatName(name){return name.htmlReplace();}
function _formatNewPhotoName(name){return name;}
function _formatFriTime(time){var nt;try{nt=friendPhoto_nowtime;}catch(e){nt=QZAPP.g_NowTime;}
var ut=time;var vt=nt-ut;var date=new Date(time*1000);var now=new Date(nt*1000);if(vt<60){return vt+"秒前";}else if(vt<60*60){return Math.floor(vt/60)+"分钟前";}else if(vt<60*60*24){if(date.getDate()==now.getDate()){return date.getHours()+":"+(date.getMinutes()>9?date.getMinutes():("0"+""+date.getMinutes()));}else{return"昨天"+date.getHours()+":"+(date.getMinutes()>9?date.getMinutes():("0"+""+date.getMinutes()));}}else if(vt<60*60*24*2){if(date.getDate()==(new Date(nt*1000-60*60*24*1000-1)).getDate()){return"昨天"+date.getHours()+":"+(date.getMinutes()>9?date.getMinutes():("0"+""+date.getMinutes()));}else{return"前天"+date.getHours()+":"+(date.getMinutes()>9?date.getMinutes():("0"+""+date.getMinutes()));}}else if(vt<60*60*24*3){if(date.getDate()==(new Date(nt*1000-60*60*24*2*1000-1)).getDate()){return"前天"+date.getHours()+":"+(date.getMinutes()>9?date.getMinutes():("0"+""+date.getMinutes()));}else{return(date.getMonth()+1)+"月"+date.getDate()+"日"+date.getHours()+":"+(date.getMinutes()>9?date.getMinutes():("0"+""+date.getMinutes()));}}else if((new Date(nt*1000).getFullYear())==date.getFullYear()){return(date.getMonth()+1)+"月"+date.getDate()+"日"+date.getHours()+":"+(date.getMinutes()>9?date.getMinutes():("0"+""+date.getMinutes()));}else{return(date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate());}}
function _formatTime(time,bLong){var date=new Date(time*1000);var str=(date.getFullYear()+"-"+(((date.getMonth()+1)>=10?(date.getMonth()+1):"0"+(date.getMonth()+1)))+"-"+(date.getDate()>=10?date.getDate():"0"+date.getDate())+" "+(bLong===true?((date.getHours()>=10?date.getHours():("0"+date.getHours()))+":"+(date.getMinutes()>=10?date.getMinutes():("0"+date.getMinutes()))+":"+(date.getSeconds()>=10?date.getSeconds():("0"+date.getSeconds()))):""));return str;}
function _isNewAlbum(mt,data){return(((QZAPP.g_NowTime-mt<30*24*60*60)&&(getNodeSubValue(data,"total")))!="0"?true:false);}
function _getAlbumLiClass(mt,data){return(_isNewAlbum(mt,data)?"new_photo_album":"")}
function _getAlbumIconClass(mt,data){return(_isNewAlbum(mt,data)?"new_photo_mark":"none");}
function _getWriterFace(face){return face.trim();}
var inner;return inner={replace:function(tpl,data,idx,conf){var str=(tpl.replace(/\<\%=\@([a-z_]+?)\|((_?[a-z]*?)|([a-z]*?\.[a-z]+?))?\%\>/gi,function(a,b,c){var value=getNodeSubValue(data,b);if(typeof value=="string"){value=value.trim();};if(value==null){return"";}
if(conf){value=_config(conf,value);}
if(c){var fn=eval(c);value=fn(value,data);}
return value;}).replace(/\<\%=index\%\>/g,idx));return str;},formatClass:_formatClass,formatTime:_formatTime}})();var AlbumList=new Class({initialize:function(){},show:function(){if(!this.prePareData()){return false;}
var container=$(this.containerID);var result=[];var start=(this.curIndex-1)*this.numInOnePage,end=Math.min(this.curIndex*this.numInOnePage,this.data.length);for(var i=start;i<end;i++){result.push(Tpl.replace(this.tpl,this.data[i],i));}
container.innerHTML=result.join("");container.style.display="";},displayErr:function(){($("album_list_container")||$("no_album_hint")).innerHTML="服务器繁忙，请您稍后再试。";QZFP.hideMsgbox();},callBack:function(xml){QZFP.hideMsgbox();checkQQShow();this.curIndex=1;return this.show();},get:function(){QZFP.showMsgbox("正在获取"+this.title+",请稍候",6,10000);QPHOTO.util.loadXMLAsync(this.xId,this.URL,this.callBack.bindAsCallBack(this),this.displayErr,false);},prePareData:function(){this.data=QZAPP.g_XDoc[this.xId];},turn:function(index){this.curIndex=index;this.show();}})
var MyAlbumList=AlbumList.extend({initialize:function(){this.speed=new TSpeed(1,0.02);this.parent();this.containerID="album_list_container";this.staticURL=getUrl("main_xml_static");this.dynamicURL=getUrl("main_xml_cgi");this.xId=16;this.numInOnePage=VersionInfo.isWider()?50:40;this.title="相册列表";this.needReport=true;},get:function(){this.speed.SetTime();if(QZAPP.g_XDoc[this.xId]){this.needReport=false;}
QPHOTO.util.loadXMLAsync(this.xId,this.staticURL,this.callBack.bindAsCallBack(this),this.staticErrBack.bind(this),false);},callBack:function(xml){this.speed.SetTime();if(this.parent()==false){return false;};Turner.init(Math.ceil(this.data.length/this.numInOnePage));User.isOwner()?DiskSpace.show():"";},staticErrBack:function(){QPHOTO.util.loadXMLAsync(this.xId,this.dynamicURL,this.callBack.bindAsCallBack(this),this.dynamicErrBack.bind(this),false);},dynamicErrBack:function(){this.displayErr();},del:function(aid,cb){if(!checkSessionUin(true)){return;}
if(!aid)return;if(!confirm("确定删除该相册？\n删除后将无法恢复。照片在日志、动感影集等处的引用也将失效！"))return;var albums=QZAPP.g_XDoc[16].selectNodes("/data/album");var idx=getIndexByValue(albums,"id",aid);if(idx==null)return;QZFP.showMsgbox("正在删除,请稍候",6,10000);if(!cb)cb=this.show.bind(this);this.doDel(aid,albums[idx],cb);QZONE.event.cancelBubble();QZONE.event.preventDefault();},doDel:function(aid,node,cb,errCb){var url=getUrl("album_del");var callBack=function(){if(checkRetXml(QZAPP.g_XDoc["del_ret"],true)){clearNewPhoto();XNode.delNode(node);QZFP.showMsgbox("删除成功",4,2000);cb();}
else{if(errCb)
try{errCb();}catch(e){}}}
var errBack=function(){alert("error");}
QZAPP.g_XDoc["del_ret"]=null;data=["uin="+QZAPP.g_iUin,"refer="+Page.getRefer(),"albumid="+aid.URIParam(),"albumname="+getNodeSubValue(node,"name").URIParam(),"modifytime="+getNodeSubValue(node,"modifytime"),"nvip="+isNVip(),"route="+getDomainXml(true),"domain="+getDomainUp(true)].join("&");QPHOTO.util.loadXMLAsync("del_ret",url,callBack,errBack,false,data);},prePareData:function(){var data=QZAPP.g_XDoc[this.xId];if(!data||data.selectSingleNode("/data/msg")||data.selectSingleNode("/err")){this.displayErr();var msg="对不起，系统忙，请稍后再试";try{msg=getNodeSubValue(data.selectSingleNode("/data"),"msg")||getNodeSubValue(data.selectSingleNode("/err"),"errMsg");}catch(e){}
QZFP.showMsgbox(msg,5,3000);if(msg.match(/963/)){$("album_list_container").innerHTML=['<div style="margin:5px">','<p style="margin:5px">尊敬的QQ空间用户：</p>','<p style="margin:5px">QQ相册正在进行系统升级维护，相册部分服务将受到影响。由此给您带来的不便，我们深表歉意，敬请广大用户谅解。</p>','<p style="margin:5px">特此通告</p>','<p align="right" style="margin:5px">QQ空间产品中心</p>','</div>'].join("");QZFP.hideMsgbox();$hide("tab_menu");$hide($("no_news_container").parentNode);}
QZAPP.g_XDoc[this.xId]=null;return false;}
var nodes=data.selectNodes("/data/album");this.hasPerAlbum=false;if(!User.isOwner()){for(var i=nodes.length-1;i>=0;i--){setNodeSubValue(nodes[i],"cursorStyle","disabled");if(parseInt(getNodeSubValue(nodes[i],"tplid"))){this.hasPerAlbum=true;}
XNode.delNodeByValue(nodes[i],"priv","3");if(parseInt(getNodeSubValue(nodes[i],"handset"))==4&&getNodeSubValue(nodes[i],"name").match(/QQ秀形象\_无背景/)){XNode.delNode(nodes[i]);}}}else{for(var i=nodes.length-1;i>=0;i--){if(parseInt(getNodeSubValue(nodes[i],"tplid"))){this.hasPerAlbum=true;}
setNodeSubValue(nodes[i],"cursorStyle","");if(parseInt(getNodeSubValue(nodes[i],"handset"))==4&&getNodeSubValue(nodes[i],"name").match(/QQ秀形象\_无背景/)){XNode.delNode(nodes[i]);}}}
nodes=data.selectNodes("/data/album");this.data=QQShowFilter(nodes);if(this.data.length==0){if(User.isOwner()){$("album_list").innerHTML='<p class="no_album_point">您还没有相册，<a href="javascript:CreatAlbum.init(true);">马上创建一个</a></p>';}else{$("album_list").innerHTML='<p class="no_album_point">没有相册</p>';}
return false;}
return true;},show:function(){if(this.parent()==false){return false;};$("album_link").innerHTML=$("album_link").innerHTML.replace(/相册.*/,"相册"+"("+this.data.length+")");if(this.needReport){this.speed.SetTime();this.speed.Report(this.getSpeedId());}},getSpeedId:function(){var url=getUrl("main_xml_static");var d=url.replace(/http:\/\/(\S+p)\..+/,"$1");switch(d){case"szp":return 1;break;case"sznewp":return 27;break;case"xap":return 28;break;case"xanewp":return 29;break;default:return 27;}},sortDataByTime:function(key){this.data.sort(function(a,b){return(getNodeSubValue(a,key)-0)>(getNodeSubValue(b,key)-0)?-1:1;});},batchOp:function(type,llocList,aid,new_aid,cb){if(!checkSessionUin(true)){return;}
if(!(type&&llocList&&aid))return;if(llocList.length==0){alert("请先选择照片!");return;}
var albums=QZAPP.g_XDoc[16].selectNodes("/data/album");var idx=getIndexByValue(albums,"id",aid);if(idx==null)return;var p_doc=albums[idx];var photos=p_doc.selectNodes("pic");var callback,op_url,cover_lloc,newCoverIdx,data,isCover=false,isDCover=false,dCoverIdx=0;var new_idx=getIndexByValue(albums,"id",new_aid);if(new_idx!=null){var totalnum=getNodeSubValue(albums[new_idx],"total");if(totalnum==0){dCoverIdx=getIndexByValue(photos,"lloc",llocList[0].split("|")[0]);if(dCoverIdx!=null){isDCover=true;}}}
idx=getIndexByValue(photos,"sloc",getNodeSubValue(p_doc,"cover_id"));if(idx==null)isCover=true;else cover_lloc=getNodeSubValue(photos[idx],"lloc");var llocStr=llocList.join("_");if(photos.length>llocList.length&&(isCover||llocStr.indexOf(cover_lloc)!=-1)){isCover=true;for(idx=0;idx<photos.length;idx++){if(llocStr.indexOf(getNodeSubValue(photos[idx],"lloc"))==-1)break;}
if(idx<photos.length)newCoverIdx=idx;else isCover=false;}else{isCover=false;}
var setNoCover=0;if(photos.length<=llocList.length){setNoCover=1;}
if(type=="del"){if(confirm("确实要删除该照片?\n删除后将无法恢复。照片在日志、动感影集等处的引用也将失效！")==false)return;op_url=getUrl("pic_mul_del");var data=["uin="+QZAPP.g_iUin,"refer="+getRefer(),"albumid="+aid.URIParam(),"codelist="+llocStr.URIParam(),"albumname="+getNodeSubValue(p_doc,"name").URIParam(),"nvip="+isNVip(),"resetcover="+setNoCover];if(QZFP.getVipStatus()&&parseInt(getNodeSubValue(p_doc,"bgid"))){data.push("bgid="+getNodeSubValue(p_doc,"bgid"));data.push("tpid="+getNodeSubValue(p_doc,"tplid"));}
data=data.join("&");if(isCover)data+="&newcover="+getNodeSubValue(photos[newCoverIdx],"sloc").URIParam();callback=function(){if(checkRetXml(QZAPP.g_XDoc["mul_proc_ret"],true)){clearNewPhoto();var succ=QZAPP.g_XDoc["mul_proc_ret"].selectNodes("/return/succ");var fail=QZAPP.g_XDoc["mul_proc_ret"].selectNodes("/return/fail");for(var i=0;i<succ.length;i++){var photolloc=getNodeSubValue(succ[i],"id");var index=getIndexByValue(photos,"lloc",photolloc);p_doc.removeChild(photos[index]);}
setNodeSubValue(p_doc,"total",p_doc.selectNodes("pic").length);if(isCover){setNodeElementValue(p_doc,"pre",getNodeSubValue(photos[newCoverIdx],"pre"));setNodeElementValue(p_doc,"url",getNodeSubValue(photos[newCoverIdx],"url"));setNodeElementValue(p_doc,"cover_id",getNodeSubValue(photos[newCoverIdx],"sloc"));}
if(typeof(cb)=="function")cb();if(fail.length==0){QZFP.showMsgbox("删除照片成功!",4,2000);}
else QZFP.showMsgbox("删除失败"+fail.length+"个!",5,2000);}
QZAPP.g_XDoc["mul_proc_ret"]=null}}else if(type=="move"){var new_album_idx=getIndexByValue(albums,"id",new_aid);if(confirm("确定要移动照片至相册"+getNodeSubValue(albums[new_album_idx],"name").unHtmlReplace().replace(/\s*$/,"")+"?")==false)return;op_url=getUrl("pic_move");var data=["uin="+QZAPP.g_iUin,"refer="+getRefer(),"old_albumid="+aid.URIParam(),"old_albumname="+getNodeSubValue(p_doc,"name").URIParam(),"new_albumid="+new_aid.URIParam(),"codelist="+llocStr.URIParam(),"nvip="+isNVip(),"resetcover="+setNoCover];if(QZFP.getVipStatus()&&parseInt(getNodeSubValue(p_doc,"bgid"))){data.push("bgid="+getNodeSubValue(p_doc,"bgid"));data.push("tpid="+getNodeSubValue(p_doc,"tplid"));}
data=data.join("&");if(isCover)data+="&newcover="+getNodeSubValue(photos[newCoverIdx],"sloc").URIParam();if(isDCover)data+="&d_newcover="+getNodeSubValue(photos[dCoverIdx],"sloc").URIParam();callback=function(){if(checkRetXml(QZAPP.g_XDoc["mul_proc_ret"],true)){clearNewPhoto();var succ=QZAPP.g_XDoc["mul_proc_ret"].selectNodes("/return/succ");var fail=QZAPP.g_XDoc["mul_proc_ret"].selectNodes("/return/fail");var n_p_doc=albums[getIndexByValue(albums,"id",new_aid)];n_p_doc.removeAttribute("isLoaded");var total=parseInt(getNodeSubValue(n_p_doc,"total"));total+=succ.length;setNodeSubValue(n_p_doc,"total",total);if(isDCover){setNodeElementValue(n_p_doc,"pre",getNodeSubValue(photos[dCoverIdx],"pre"));setNodeElementValue(n_p_doc,"url",getNodeSubValue(photos[dCoverIdx],"url"));setNodeElementValue(n_p_doc,"cover_id",getNodeSubValue(photos[dCoverIdx],"sloc"));}
for(var i=0;i<succ.length;i++){var photolloc=getNodeSubValue(succ[i],"id");var index=getIndexByValue(photos,"lloc",photolloc);p_doc.removeChild(photos[index]);}
setNodeSubValue(p_doc,"total",p_doc.selectNodes("pic").length);if(isCover){setNodeElementValue(p_doc,"pre",getNodeSubValue(photos[newCoverIdx],"pre"));setNodeElementValue(p_doc,"url",getNodeSubValue(photos[newCoverIdx],"url"));}
if(typeof(cb)=="function")cb();if(fail.length==0)QZFP.showMsgbox("移动照片成功!",4,2000);else QZFP.showMsgbox("移动失败"+fail.length+"个!",5,2000);}
QZAPP.g_XDoc["mul_proc_ret"]=null}}
QZAPP.g_XDoc["mul_proc_ret"]=null;QPHOTO.util.loadXMLAsync("mul_proc_ret",op_url,callback,callback,true,data);},tpl:'<li id="album_li_<%=@id|%>" class="<%=@modifytime|_getAlbumLiClass%> <%=@tplid|_getPerAlbumLiClass%>"><strong id="album_strong_<%=@id|%>" class="<%=@tplid|_getPerAlbumIconClass%>"><span class="none">个性相册</span></strong><strong class="<%=@modifytime|_getAlbumIconClass%>"><span class="none">有新的照片</span></strong><a href="javascript:getPhotoPolicy(PhotoList.enter.pass(\'<%=@id|%>\'))" class="album_list_pic"><img src="about:blank;" style="display:none" alt="<%=@desc|_formatCoverTips%>" onerror="this.onerror=null;Img.preLoad(this,\'<%=@pre|%>\')" /></a><p class="album_name <%=@handset|_formatTypeIcon%>"><span class="album_name_cont"><a class="c_tx" href="javascript:getPhotoPolicy(PhotoList.enter.pass(\'<%=@id|%>\',true))" title="<%=@name|%>"><%=@name|%></a></span><span style="<%=@tplid|_getPerAlbumNormClass%>" class="album_normal_view"><a href="javascript:getPhotoPolicy(PhotoList.enter.pass(\'<%=@id|%>\',true))" title="进入普通模式查看" class="unline">普通</a></span></p><p class="album_list_info c_tx3"><span class="album_list_info_operate"><button <%=@cursorStyle|%> onclick="AlbumAttr.privModDlg(\'<%=@id|%>\')" class="<%=@priv|_formatPrivIcon%>" title="<%=@priv|_formatPrivDesc%>"><span><%=@priv|_formatPrivDesc%></span></button><button onclick="Page.delAlbum(\'<%=@id|%>\')" class="icon_photo_delete author-display" title="删除"><span>删除</span></button></span>共<%=@total|%>张</p></li>'});var SpecialAlbum=AlbumList.extend({initialize:function(xid,uid,cid,path){this.parent();this.containerID=cid;;this.URL=getUrl(uid);this.xId=xid;this.path=path;this.numInOnePage=VersionInfo.isWider()?4:3;},prePareData:function(){var data=QZAPP.g_XDoc[this.xId];var nodes=data.selectNodes("/data/"+this.path);if(!User.isOwner()){}
this.data=$A(nodes);if(this.data.length==0){return false;}
return true;},setIndex:function(){this.curIndex=1;},show:function(){if(!this.prePareData()){this.showPage(true);return;}
this.setIndex();this.totalIndex=Math.ceil(this.data.length/this.numInOnePage);this.showPage();},showPage:function(isnone){if(isnone){HelpDoc.init(false);$("no_album_hint").innerHTML=this.noDataHint;$("no_album_hint").style.display="";$(this.containerID).style.display="none";return;}
$("no_album_hint").style.display="none";HelpDoc.init(true);var container=$(this.containerID);var result=[];var start=(this.curIndex-1)*this.numInOnePage,end=Math.min(this.curIndex*this.numInOnePage,this.data.length);for(var i=start;i<end;i++){result.push(Tpl.replace(this.tpl,this.data[i],i));}
container.innerHTML=result.join("");container.style.display="";this.buildTurner();},buildTurner:function(){var t=this;loadJs("/qzone/app/f4a/F4A_1.0.js",function(){loadJs("/qzone/app/controls/pager/pager.js",function(){t.turner=new F4A.widget.Pager($("page_turner"),{"totalPage":t.totalIndex,"currentPage":t.curIndex,"offsetPage":2,"hideEmpty":true,"onTurn":function(index,total){t.curIndex=index;t.showPage();location.pathname.indexOf("new_photo")==-1?refreshPing(2):refreshPing(1);}})});},QZFL.emptyFn)
return;if(this.totalIndex<=1){$("page_turner").style.display="none";return;}
var start=Math.max(this.curIndex-3,1);var end=Math.min(start+6,this.totalIndex);start=Math.max(end-6,1);var result=[];for(var i=start;i<=end;i++){if((start>=2&&i==start)){result.push('<A class="bor2" href="javascript:Album.turn2Page(1)">1</A> <STRONG class="ellipsis bor2">...</STRONG>');continue;}
if((end<=this.totalIndex-1&&i==end)){result.push('<STRONG class="ellipsis bor2">...</STRONG><A class="bor2" href="javascript:Album.turn2Page('+this.totalIndex+')">'+this.totalIndex+'</A> ');continue;}
result.push((i!=this.curIndex)?'<a class="bor2" href="javascript:Album.turn2Page('+i+')">'+i+'</a> ':'<strong class="c_tx bor2">'+i+'</strong>');}
var pre=$("turner_preview");var next=$("turner_next");var _s=[];if(this.curIndex==1){_s.push("上一页");}else{_s.push('<a id="turner_preview" class="bor2 prev_page" href="javascript:Album.turn2Preview();">上一页</a>');}
_s.push('<span id="page_list">'+result.join("")+' </span>');if(this.curIndex==this.totalIndex){_s.push("下一页");}else{_s.push('<a id="turner_next" class="bor2 next_page" href="javascript:Album.turn2Next();">下一页</a>');}
(pre||next).parentNode.innerHTML=_s.join("");var o=this;QZONE.event.addEvent($("pageIndex"),"keydown",function(e){e=QZONE.event.getEvent(e);if(e.keyCode==13){o.turn();}});$("page_turner").style.display="";},turn2Preview:function(){this.turn2Page(this.curIndex-1);},turn2Next:function(){this.turn2Page(this.curIndex+1);},turn2Page:function(index){if(index<1){QZFP.showMsgbox("当前页已经是第一页",3,1500);return;}
if(index>this.totalIndex){QZFP.showMsgbox("当前页已经是最后一页",3,1500);return;}
this.curIndex=index;this.showPage();try{QZFP.setScrollTop(0);}catch(e){};location.pathname.indexOf("new_photo")==-1?refreshPing(2):refreshPing(1);},turn:function(){var index=parseInt($("pageIndex").value,10);if(isNaN(index)){QZFP.showMsgbox("请填入正确的页码!",3,1500)
return;}
if(index<1||index>this.totalIndex){QZFP.showMsgbox("此页码不存在!",3,1500)
return;}
this.turn2Page(index);},delAlbum:function(idx){var data=QZAPP.g_XDoc[this.xId];var nodes=data.selectNodes("/data/"+this.path);XNode.delNode(nodes[idx]);QZFP.showMsgbox("删除成功",4,2000);this.data.splice(idx,1);this.totalIndex=Math.ceil(this.data.length/this.numInOnePage);this.showPage(this.data.length==0?true:false);}})
var MarkedAlbumList=SpecialAlbum.extend({initialize:function(xid,uid,cid,path){this.containerID=cid;this.URL="http://photo.qq.com/cgi-bin/common/cgi_list_mymark";this.xId=xid;this.path=path;this.numInOnePage=VersionInfo.isWider()?4:3;this.title="圈圈照片";this.tabLink="loop_link"
this.noDataHint='<span class="author-display">您</span><span class="visitor-display">当前用户</span>'+"还没有"+this.title;this.numInOnePage=(QZONE.FP._t.QZONE.dataCenter.get("photoEnvironmeng")=="myhome"?8:VersionInfo.isWider()?12:8);},changeAlbumStatus:function(idx,status){this.data[idx]["status"]=(status-0)?0:1;this.showPage();},prePareData:function(){var data=QZAPP.g_JData[this.xId];this.data=data.rec||[];if(this.data.length<1){return false;}
return true;},delAlbum:function(idx){QZFP.showMsgbox("删除成功",4,2000);this.data.splice(idx,1);this.totalIndex=Math.ceil(this.data.length/this.numInOnePage);this.showPage(this.data.length==0?true:false);},get:function(){var data={t:Math.random()}
dataLoader(this.xId,this.URL,data,this.callBack.bind(this),this.displayErr);},tpl:'<li class="drew_photo_list"><div class="drew_photo_pic bor3"><a href="http://user.qzone.qq.com/<%=@owner|%>/photo/<%=@albumid|%>/<%=@lloc|%>/" target="_blank"><img src="<%=@sUrl|%>" onload="this.onload=null;Img.preLoad(this,\'<%=@sUrl|%>\')" alt="圈圈照片" title="圈圈照片" /></a></div><div class="drew_photo_info"><p style="visibility:hidden">圈圈状态：<%=@status|_formatMarkedStatus%></p><p style="visibility:hidden">圈圈说明：<%=@content|_formatMarkedTips%></p><p>照片主人：<a href="http://<%=@owner|%>.qzone.qq.com" target="_blank;"><%=@nick|%></a></p><p class="verify_operate"><a style="visibility:hidden" class="author-display" href="javascript:Album.changeStatus(<%=@id|%>,<%=index%>,<%=@status|%>)"><%=@status|_reverseMarkedStatus%></a> <a class="author-display" href="javascript:Album.delAlbum(<%=@id|%>,\'<%=@albumid|%>\',\'<%=@lloc|%>\',\'<%=@owner|%>\',\'<%=@picmarkid|%>\',<%=index%>)">删除</a></p></div></li>'});var FlashAlbumList=SpecialAlbum.extend({initialize:function(xid,uid,cid,path){this.parent(xid,uid,cid,path);this.title="动感影集";this.tabLink="flash_link";this.noDataHint='<span class="author-display">您</span><span class="visitor-display">当前用户</span>'+"还没有"+this.title+',<a class="author-display c_tx" href="javascript:Album.make();">马上去制作一个</a>';this.numInOnePage=(QZONE.FP._t.QZONE.dataCenter.get("photoEnvironmeng")=="myhome"?6:VersionInfo.isWider()?8:6);},prePareData:function(){var data=QZAPP.g_JData[this.xId];this.data=data.flash||[];if(this.data.length<1){return false;}
return true;},delAlbum:function(idx){QZFP.showMsgbox("删除成功",4,2000);this.data.splice(idx,1);this.totalIndex=Math.ceil(this.data.length/this.numInOnePage);this.showPage(this.data.length==0?true:false);},get:function(){var data={output_type:"json",t:Math.random()}
dataLoader(this.xId,this.URL,data,this.callBack.bind(this),this.displayErr);},tpl:'<li><div class="vphoto_item bor3"><a href="javascript:Album.goPhoto(\'<%=@id|%>\')" class="album_list_pic"><img style="display:none;" src="about:blank;" onerror="this.onerror=null;Img.preLoad(this,\'<%=@url|%>\',200,156)" alt="<%=@name|%>"><span></span></a></div><div class="vphoto_list_operate"><span class="vphoto_item_operate"><button onclick="Album.share(\'<%=@id|%>\');" class="share_icon" title="共享动感影集"><span>共享动感影集</span></button><button onclick="Album.edit(\'<%=@id|%>\');" class="set_icon author-display" title="编辑"><span>编辑</span></button><button onclick="Album.delAlbum(<%=index%>);" class="icon_photo_delete author-display" title="删除"><span>删除</span></button></span><%=@name|%></div></li>'});var AvatarAlbumList=SpecialAlbum.extend({initialize:function(xid,uid,cid,path){this.parent(xid,uid,cid,path);this.title="大头贴";this.tabLink="bighead_link";this.noDataHint='<span class="author-display">您</span><span class="visitor-display">当前用户</span>'+"还没有"+this.title+',<a class="author-display" href="javascript:Album.make();">马上去制作一个</a>';this.numInOnePage=VersionInfo.isWider()?5:4;},tpl:'<li><div class="bighead_item bor3"><object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0" id="4" align="middle" width="120" height="186"><param name="allowScriptAccess" value="sameDomain" /><param name="movie" value="<%=@url|%>" /><param name="quality" value="high" /><param name="wmode" value="transparent"/><param name="bgcolor" value="#ffffff" /><embed src="<%=@url|%>" quality="high" bgcolor="#ffffff" name="4444" align="middle" allowscriptaccess="sameDomain" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" /></object></div><div class="bighead_list_operate" ><span class="bighead_item_operate"><button onclick="Album.share(\'<%=@url|%>\');" class="share_icon" title="共享大头贴"><span>共享大头贴</span></button></span></div></li>'});var FriendPhotoAlbum=SpecialAlbum.extend({initialize:function(){LTP=[];LTP[LTP.length]=new Date();QZONE.event.addEvent(window,"unload",function(){try{QZFP.hideMsgbox();}catch(e){}})
this.containerID="friend_photo_list";this.title="好友照片";this.url="http://app.photo.qq.com/cgi-bin/app/cgi_list_friendphoto?refer=qzone&";this.numInOnePage=10;this.total=0;this.curCount=0;this.data={};this.pageNumPerQuery=3;this.startIndex=0;this.curIndex=1;this.waitingMsg="正在获取图片列表,请稍候...";},get:function(index){QZFP.showMsgbox(this.waitingMsg,6,10000);var _t=this;QZONE.FP.getRemarkList(function(o){_t.friendData=o;_t.buildParam(index);LTP[LTP.length]=new Date();QPHOTO.util.loadJsonData(_t.xId,_t.url+_t.queryParams,_t.callBack.bind(_t),null,true,"gb2312","_Callback");})},buildParam:function(index){var sort=1;if(index){this.curIndex=Math.floor(index/this.numInOnePage)+1;this.startIndex=this.numInOnePage*(Math.ceil(this.curIndex/this.pageNumPerQuery)-1)*this.pageNumPerQuery;}
if(this.startIndex==0||this.startIndex==1){setFriPhotoReqFriData();if(getFriPhotoReqStatus()){sort=0;}}
this.queryParams="list_type="+this.type+"&start_index="+this.startIndex+"&num="+this.numInOnePage*this.pageNumPerQuery+"&spaceuin="+QZAPP.g_iLoginUin+"&sort="+sort+"&t="+getFriPhotoRandomSeed();},callBack:function(){LTP[LTP.length]=new Date();QZFP.hideMsgbox();var data=QZAPP.g_JData[this.xId];if(data.error){if(/900/.test(data.error.errno)){LoginBack=Class.empty;QZFP.showLoginBox("photo");}else{QZFP.showMsgbox(data.error.msg,5,2000);}}else if(data.data){this.data[Math.floor(this.startIndex/this.numInOnePage/this.pageNumPerQuery)]=data.data[this.key];this.total=data.data.total;friendPhoto_nowtime=data.data.time;this.show();}
QZAPP.g_JData[this.xId]=null;LTP[LTP.length]=new Date();sendFriSpeedReport(this.xId,LTP);},show:function(){if(this.total==0){$("friend_photo_div").innerHTML="当前查看好友照片的用户过多，请您稍后再试。";return;}
this.totalIndex=Math.ceil(this.total/this.numInOnePage);this.showPage();},showPage:function(){var container=$(this.containerID);container.innerHTML=this.getResult().join("");container.style.display="";this.buildTurner();QZONE.namecard.init(this.containerID);},getResult:function(){var result=[];var start=(this.curIndex-1)*this.numInOnePage%(this.numInOnePage*this.pageNumPerQuery);var end=Math.min(start+this.numInOnePage,start+(this.total-(this.curIndex-1)*this.numInOnePage));var data=this.data[Math.floor((this.curIndex-1)/this.pageNumPerQuery)];for(var i=start;i<end;i++){var backname=(this.friendData[data[i].owner]||"").htmlReplace();try{data[i].timenick=charTrim((backname||data[i].nick),7,true);data[i].albumnick=charTrim((backname||data[i].nick),10,true);data[i].nick=(backname||data[i].nick);}catch(e){};data[i].vip_level_class=data[i].is_yellow?("icon_vip_yl"+data[i].yellow_score):"none";data[i].album_index=i%this.numInOnePage+(this.curIndex-1)*this.numInOnePage
result.push(Tpl.replace(this.tpl,data[i],i+(Math.ceil((this.curIndex/3))-1)*this.numInOnePage*this.pageNumPerQuery));}
return result;},turn2Page:function(index){if(index<1){QZFP.showMsgbox("当前页已经是第一页",3,1500);return;}
if(index>this.totalIndex){QZFP.showMsgbox("当前页已经是最后一页",3,1500);return;}
this.curIndex=index;if(!this.data[Math.ceil(index/this.pageNumPerQuery)-1]){this.startIndex=this.numInOnePage*(Math.ceil(index/this.pageNumPerQuery)-1)*this.pageNumPerQuery;this.get();}else{this.showPage();}
try{QZFP.setScrollTop(0);}catch(e){};}});var FriTimeAlbum=FriendPhotoAlbum.extend({initialize:function(){this.parent();this.xId="friend_photo_list_time";this.key="photo";this.type=1;this.waitingMsg="正在获取图片列表,请稍候...";},tpl:['<li>','<div class="photo_list_pic bor2"><a href="javascript:Page.click(<%=index%>);">','<img style="display:none;" src="about:blank;" onerror="this.onerror=null;Img.preLoad(this,\'<%=@small_url|%>\');"/>','</a></div>','<ul class="nofloat">','<li class="tx_fix"><%=@title|%></li>','<li><%=@uploadtime|_formatFriTime%></li>','<li class="tx_fix">','来自：<a href="http://<%=@owner|%>.qzone.qq.com" onclick="sendFriStatic(\'friendphotoact\',\'readfriendzone\');return true;" link="nameCard_<%=@owner|%>" target="_blank;" class="c_tx unline q_namecard"><%=@timenick|%></a>','&nbsp;<img style="cursor:pointer" onclick="window.open(\'http://user.qzone.qq.com/<%=@owner|%>/yellowgrade\')" src="/ac/b.gif" alt="黄钻贵族" class="<%=@vip_level_class|%>" />','</li>','</ul>','</li>'].join("")});var FriUserAlbum=FriendPhotoAlbum.extend({initialize:function(){this.parent();this.xId="friend_photo_list_fri";this.key="friend";this.type=3;this.numInOnePage=6;this.waitingMsg="正在获取好友图片列表,请稍候...";},getResult:function(){var result=[];var start=(this.curIndex-1)*this.numInOnePage%(this.numInOnePage*this.pageNumPerQuery);var end=Math.min(start+this.numInOnePage,start+(this.total-(this.curIndex-1)*this.numInOnePage));var data=this.data[Math.floor((this.curIndex-1)/this.pageNumPerQuery)];for(var i=start;i<end;i++){data[i].vip_level_class=data[i].is_yellow?("icon_vip_yl"+data[i].yellow_score):"none";if(data[i].total_new<3){data[i].moreCls="none";}else{data[i].moreCls="";}
data[i].nick=((this.friendData[data[i].owner]||"").htmlReplace()||data[i].nick);data[i].user_index=(this.curIndex-1)*this.numInOnePage+i%this.numInOnePage;var s=Tpl.replace(this.tpl,data[i],i);var list=[];for(var j=0;j<data[i].photo.length;j++){data[i].photo[j].vip_level_class=data[i].is_yellow?("icon_vip_yl"+data[i].yellow_score):"none";data[i].photo[j].owner=data[i].owner;data[i].photo[j].total_new=data[i].total_new;data[i].photo[j].portrait=data[i].portrait;data[i].photo[j].nick=(this.friendData[data[i].owner]||data[i].nick);data[i].photo[j].is_yellow=data[i].is_yellow;data[i].photo[j].yellow_score=data[i].yellow_score;data[i].photo[j].user_index=data[i].user_index;list.push(Tpl.replace('<li class="photo_list_pic bor2"><a href="javascript:Page.click(\'<%=@owner|%>\',\'<%=@total_new|%>\',\'<%=@portrait|%>\',\'<%=@nick|_formatName%>\',<%=@is_yellow|%>,<%=@yellow_score|%>,<%=@user_index|%>,\'<%=index%>\')"><img style="display:none;" src="about:blank;" onerror="this.onerror=null;Img.preLoad(this,\'<%=@small_url|%>\',70,70);"/></a></li>',data[i].photo[j],j))}
s=s.replace(/_piclist_/,list.join(""));result.push(s);}
return result;},tpl:['<li class="bgr2">','<div class="left"><a class="q_namecard" link="nameCard_<%=@owner|%>" href="http://<%=@owner|%>.qzone.qq.com" target="_blank;" onclick="sendFriStatic(\'friendphotoact\',\'readfriendzone\');return true;">','<img style="display:none;" src="about:blank;" onerror="this.onerror=null;Img.preLoad(this,\'<%=@portrait|%>\',50,50);" />','</a></div>','<ul class="nofloat">','<li><img style="cursor:pointer;margin-right:4px;" onclick="window.open(\'http://user.qzone.qq.com/<%=@owner|%>/yellowgrade\')" src="/ac/b.gif" alt="黄钻贵族" class="<%=@vip_level_class|%>" /><a href="javascript:Page.click(\'<%=@owner|%>\',\'<%=@total_new|%>\',\'<%=@portrait|%>\',\'<%=@nick|_formatName%>\',<%=@is_yellow|%>,<%=@yellow_score|%>,<%=@user_index|%>)" class="c_tx unline"><%=@nick|%>的最新照片</a></li>','<li>共<%=@total_new|%>张</li>','<li>最后更新于<%=@modifytime|_formatFriTime%></li>','</ul>','<div class="tbor3">','<ul>','_piclist_','</ul>','<a href="javascript:Page.click(\'<%=@owner|%>\',\'<%=@total_new|%>\',\'<%=@portrait|%>\',\'<%=@nick|_formatName%>\',<%=@is_yellow|%>,<%=@yellow_score|%>,<%=@user_index|%>)" class="c_tx unline more <%=@moreCls|%>">更多...</a>','</div>','</li>'].join("")});var friAlbum=FriendPhotoAlbum.extend({initialize:function(){this.parent();this.xId="friend_photo_list_album";this.key="album";this.type=2;this.numInOnePage=6;this.waitingMsg="正在获取相册列表,请稍候...";},tpl:['<li>','<div class="album_list_pic"><a href="javascript:Page.click(\'<%=@owner|%>\',\'<%=@total_new|%>\',\'<%=@portrait|%>\',\'<%=@nick|_formatName%>\',\'<%=@albumid|%>\',<%=@is_yellow|%>,<%=@yellow_score|%>,\'<%=@album_title|%>\',<%=@album_index|%>)">','<img style="display:none;" src="about:blank;" onerror="this.onerror=null;Img.preLoad(this,\'<%=@cover|%>\');" title="<%=@album_desc|_formatName%>"/>','</a></div>','<ul class="nofloat">','<li><strong><a href="javascript:Page.click(\'<%=@owner|%>\',\'<%=@total_new|%>\',\'<%=@portrait|%>\',\'<%=@nick|_formatName%>\',\'<%=@albumid|%>\',<%=@is_yellow|%>,<%=@yellow_score|%>,\'<%=@album_title|%>\',<%=@album_index|%>);" class="c_tx unline"><%=@album_title|%></a></strong></li>','<li class="tx_fix sptb">来自：<a href="http://<%=@owner|%>.qzone.qq.com" onclick="sendFriStatic(\'friendphotoact\',\'readfriendzone\');return true;" target="_blank;" link="nameCard_<%=@owner|%>" class="c_tx unline q_namecard"><%=@albumnick|%></a>&nbsp;<img style="cursor:pointer" onclick="window.open(\'http://user.qzone.qq.com/<%=@owner|%>/yellowgrade\')" src="/ac/b.gif" alt="黄钻贵族" class="<%=@vip_level_class|%>" /></li>','<li>共<%=@total_new|%>张新照片</li>','<li>最后更新于<%=@modifytime|_formatFriTime%></li>','</ul>','</li>'].join("")});var FriPhotoList=FriendPhotoAlbum.extend({initialize:function(uin,total,startIndex){this.parent();this.xId="friend_photo_list";this.type=4;this.uin=uin;this.startIndex=startIndex;this.total=total;this.key="photo";},buildParam:function(index){if(index){this.curIndex=Math.floor(index/this.numInOnePage)+1;this.startIndex=this.numInOnePage*(Math.ceil(this.curIndex/this.pageNumPerQuery)-1)*this.pageNumPerQuery;}
this.queryParams="list_type="+this.type+"&start_index="+this.startIndex+"&num="+this.numInOnePage*this.pageNumPerQuery+"&uin="+this.uin+"&spaceuin="+QZAPP.g_iLoginUin+"&sort="+1+"&t="+getFriPhotoRandomSeed();},callBack:function(){LTP[LTP.length]=new Date();QZFP.hideMsgbox();var data=QZAPP.g_JData[this.xId];if(data.error){if(/900/.test(data.error.errno)){LoginBack=Class.empty;QZFP.showLoginBox("photo");}else{QZFP.showMsgbox(data.error.msg,5,2000);}}else if(data.data){this.data[Math.floor(this.startIndex/this.numInOnePage/this.pageNumPerQuery)]=data.data[this.key];this.total=data.data.total;friendPhoto_nowtime=data.data.time;this.show();}
LTP[LTP.length]=new Date();sendFriSpeedReport(this.xId,LTP);},tpl:['<li>','<div class="photo_list_pic bor2"><a href="javascript:Page.click(<%=index%>);">','<img style="display:none;" src="about:blank;" onerror="this.onerror=null;Img.preLoad(this,\'<%=@small_url|%>\');"/>','</a></div>','<ul class="nofloat">','<li class="tx_fix"><%=@title|%></li>','</ul>','</li>'].join("")});var AlbumPhotoList=FriendPhotoAlbum.extend({initialize:function(aid,total,startIndex,uin){this.parent();this.xId="album_photo_list";this.type=5;this.aid=aid;this.uin=uin;this.startIndex=startIndex;this.total=total;this.key="photo";this.numInOnePage=12;},buildParam:function(index){if(index){this.curIndex=Math.floor(index/this.numInOnePage)+1;this.startIndex=this.numInOnePage*(Math.ceil(this.curIndex/this.pageNumPerQuery)-1)*this.pageNumPerQuery;}
this.queryParams="list_type="+this.type+"&start_index="+this.startIndex+"&num="+this.numInOnePage*this.pageNumPerQuery+"&albumid="+this.aid+"&uin="+this.uin+"&spaceuin="+QZAPP.g_iLoginUin+"&sort="+1+"&t="+getFriPhotoRandomSeed();},callBack:function(){FriPhotoList.prototype.callBack.call(this);try{$("pic_num").innerHTML=this.total;var data=QZAPP.g_JData[this.xId].data;Img.preLoad($("info_album_cover"),this.data[0][0].big_url,140,140);QZONE.event.addEvent($("info_album_cover"),"click",(function(){window.open("http://user.qzone.qq.com/"+this.data[0][0].owner+"/photo/"+data.albumid);sendFriStatic("friendphotoact","readoriginalalbum");}).bind(this))
$("info_album_title").innerHTML=data.album_title.trim();if(!data.album_title.trim()){$hide("info_album_title");}
$("info_album_desc").innerHTML=data.album_desc.trim();if(!data.album_desc.trim()){$hide("info_album_desc");}
$("info_album_update").innerHTML=Tpl.formatTime(data.album_modifytime);}catch(e){};},tpl:FriPhotoList.prototype.tpl})
﻿var SpecialAlbums=(function(){var _albumList;function _getAlbumList(type){switch(type){case 1:return new MyAlbumList;case 2:return new MarkedAlbumList("marked_list","list_marked","marked_photo_list","rec");case 3:return new FlashAlbumList("flash_album","vphoto_list","flash_list","flash");case 4:return new AvatarAlbumList("bighead_list","avatar_list","bighead_list","avatar");default:return new MyAlbumList;}}
var inner;return inner={init:function(type){cssChange();_albumList=_getAlbumList(type);_albumList.get();},turn2Preview:function(){_albumList.turn2Preview();},turn2Next:function(){_albumList.turn2Next();},turn2Page:function(index){_albumList.turn2Page(index);},getAlbumList:function(){return _albumList;},turn:function(){_albumList.turn();}}})();var PhotoList=(function(){var _aid,_lloc;var curAlbum=null;var photos=null;var numInOnepage=VersionInfo.isWider()?15:12;var xId="album_migrated_static";var speedStatistic=new TSpeed(2,0.02);var tpl='<li><div class="photo_list_pic bor2"><a href="javascript:Page.clickPic(\'<%=@lloc|%>\',\'<%=index%>\')"><img style="display:none;" src="about:blank;" alt="<%=@name|%>" onerror="this.onerror=null;Img.preLoad(this,\'<%=@pre|%>\',null,null,null,true,\'small\')" /></a></div><p class="photo_name"><label for="photo_list_<%=index%>"><input type="checkbox" name="pic_checkbox" class="select_photo_list author-display edit-mode" id="photo_list_<%=index%>" lloc="<%=@lloc|%>|<%=@uploadtime|parseTime%>|<%=@forum|%>" index="<%=index%>" /><%=@name|%></label></p></li>';function _buildHTML(idx){var start=idx*numInOnepage;var end=Math.min((idx+1)*numInOnepage,photos.length);var result=[];for(var i=start;i<end;i++){result.push(Tpl.replace(tpl,photos[i],i));}
return result.join("");}
function _checkLoaded(aid){var albums=QZAPP.g_XDoc[16].selectNodes("/data/album");var idx=getIndexByValue(albums,"id",aid);if(idx==null){return false;}
if(albums[idx].getAttribute("isLoaded")){return true;}else{return false;}}
function _getPriv(aid){var albums=QZAPP.g_XDoc[16].selectNodes("/data/album");var idx=getIndexByValue(albums,"id",aid);var priv=getNodeSubValue(albums[idx],"priv");return priv;}
function _showPassword(aid,priv,cb){PasswordDlg.show();window.passwdSubmit=function(){var verifycode=$("input_verifycode")!=null?$("input_verifycode").value:null;if(!verifycode||$("album_passwd").value==""){alert("密码或者验证码不能为空.");return;}
var callBack=function(xml){var data=xml.responseXML;if(data.selectSingleNode("album")){PasswordDlg.hide();QZFP.showMsgbox("正在加载相册,请稍候",6,5000);_replaceAlbum(data,aid);cb(priv);}else{checkRetXml(data,true);PasswordDlg.refresh();}}
var errBack=function(){alert("error");PasswordDlg.hide();}
var url=getUrl("album_view_private")+"&albumid="+aid+"&password="+MD5($("album_passwd").value)+"&verifycode="+verifycode;QZFP.showMsgbox("正在验证密码，请稍候...",6,5000);QPHOTO.util.loadXMLAsync("temp_album",url,callBack,errBack,true);}}
function _replaceAlbum(data,aid){var newAlbum=data.selectSingleNode("album");newAlbum.setAttribute("isLoaded",true);var album=_getAlbum(aid);var handset=getNodeSubValue(album,"handset");if(handset==null)handset=0;newAlbum.setAttribute("handset",handset);setNodeSubValue(newAlbum,"priv",getNodeSubValue(album,"priv"));try{setNodeSubValue(newAlbum,"tplid",getNodeSubValue(album,"tplid"));setNodeSubValue(newAlbum,"bgid",getNodeSubValue(album,"bgid"));}catch(e){};QZAPP.g_XDoc[16]=XNode.replaceNode(album,newAlbum)||QZAPP.g_XDoc[16];_checkAlbumCover(newAlbum);return newAlbum;}
function _checkAlbumCover(album){var photos=album.selectNodes("pic");if((!getNodeSubValue(album,"url").match(/imgcache\.qq\.com/))||photos.length<1){return;}
setNodeSubValue(album,"pre",getNodeSubValue(photos[0],"pre"));setNodeSubValue(album,"url",getNodeSubValue(photos[0],"url"));setNodeSubValue(album,"cover_id",getNodeSubValue(photos[0],"sloc"));if(User.isOwner()){setTimeout(PhotoList.setAlbumCover.pass(getNodeSubValue(album,"id"),getNodeSubValue(photos[0],"sloc")),1000);}}
function _checkAlbumPriv(aid,cb){var priv=_getPriv(aid);if(priv==null){qz_go_imc("nonexists.html");return;}
priv=parseInt(priv);if(priv>10)priv-=10;if(_checkLoaded(aid))
priv=1;if(QZAPP.g_iUin==QZAPP.g_iLoginUin){if(priv!=1){priv=3;}}else if(priv==5){priv=2;}else if(priv!=1){priv=3;}
switch(priv){case 1:case 3:cb(aid,priv);break;case 2:_showPassword(aid,priv,cb);break;default:qz_go_imc("photo_list.htm",aid);}}
function _getAlbum(aid){var albums=QZAPP.g_XDoc[16].selectNodes("/data/album");var idx=getIndexByValue(albums,"id",aid);return albums[idx];}
function _loadAlbum(aid,priv,cb,errCb){if(_checkLoaded(aid)&&cb){cb();return;}
speedStatistic.SetTime();if(QZAPP.g_iUin==QZAPP.g_iLoginUin){if(priv!=1){priv=3;}}else if(priv==5){priv=2;}else if(priv!=1){priv=3;}
switch(parseInt(priv)){case 2:_showPassword(aid,priv,cb||_show);return;case 3:url=getUrl("album_view_private")+"&albumid="+aid;break;default:url=getUrl("album_migrated_static",aid);}
QZAPP.g_XDoc["tmp_album"]=null;var state="static";errBack=function(){state="dynamic";_loadDynamicAlbum(aid,callBack,errCb||function(){});}
var callBack=function(){try{speedStatistic.SetTime();QZFP.hideMsgbox();curAlbum=_replaceAlbum(QZAPP.g_XDoc["temp_album"],aid);if(cb){cb();speedStatistic.SetTime();speedStatistic.Report();return;}
_show();speedStatistic.SetTime();speedStatistic.Report();}catch(e){checkRetXml(QZAPP.g_XDoc["temp_album"],true);QZAPP.g_XDoc["temp_album"]=null;if(priv<=1&&state=="static"){errBack();}else{setTimeout(function(){qz_go_imc("album_list.htm")},2000);}}}
QZFP.showMsgbox("正在读取图片列表，请稍候...",6,10000);QZAPP.g_XDoc["temp_album"]=null;QPHOTO.util.loadXMLAsync("temp_album",url,callBack,priv<=1?errBack:Class.empty);}
function _loadDynamicAlbum(aid,cb){var url=getUrl("album_view_private")+"&albumid="+aid;QZAPP.g_XDoc["tmp_album"]=null;QZFP.showMsgbox("正在读取图片列表，请稍候...",6,10000);QPHOTO.util.loadXMLAsync("temp_album",url,cb);}
function _show(bNormal){if(getParameter("personaldisplay")&&getParameter("tpl_id")&&getParameter("remark")&&!bNormal&&QZONE.FP.getVipStatus()){if(parseInt(getNodeSubValue(curAlbum,"total"))==0){alert("当前相册内无照片，请选择其他相册");qz_go_imc("album_list.htm");return;}
var fid=getParameter("tpl_id")+"_"+getParameter("remark");displayCustomSlideInQzone(curAlbum,_aid,fid,function(){_show(true);});return;}else{AlbumInfo.show(curAlbum);photos=$A(XMLselectNodes(curAlbum,"pic"));var idx=getIndexByValue(photos,"lloc",_lloc);if(!idx)idx=0;idx++;Turner.init(Math.ceil(photos.length/numInOnepage),Math.ceil(idx/numInOnepage));inner.change(Math.ceil(idx/numInOnepage)-1);fixHeight();}}
function _prepareLoad(){if(_checkLoaded(_aid)){curAlbum=_getAlbum(_aid);_show();}else{_checkAlbumPriv(_aid,_loadAlbum);}}
var inner;return inner={change:function(index){$("photo_list").innerHTML=_buildHTML(index);$("all_select").checked=false;},enter:function(aid,bNormal){if(QZAPP.photoPolicyData.viewright==1){QZFP.showMsgbox("因网络故障，该相册暂时无法查看．",5,2000);return;}
var callBack=function(){curAlbum=_getAlbum(aid);if(bNormal){qz_go_imc("photo_list.htm",aid);}else if(parseInt(getNodeSubValue(curAlbum,"tplid"),10)&&QZONE.FP.getVipStatus()){if(parseInt(getNodeSubValue(curAlbum,"total"))==0){QZFP.showMsgbox("当前相册内无照片，请选择其他相册",3,2000);return;}
var fid=getNodeSubValue(curAlbum,"bgid")+"_"+getNodeSubValue(curAlbum,"tplid")
var priv=getNodeSubValue(curAlbum,"priv");PhotoList.loadAlbum(aid,priv,displayCustomSlideInQzone.pass(null,aid,fid))}else{qz_go_imc("photo_list.htm",aid);}}
_checkAlbumPriv(aid,callBack);},reload:function(aid){var callBack=function(){};_checkAlbumPriv(aid,callBack);},viewPhoto:function(aid,lloc,type){if(type==3){qz_go_imc('flash_photo_view.htm',lloc,null,"from=rctcmt");return;}
var callBack=function(){qz_go_imc('photo_view.htm',aid,lloc,"from=rctcmt");}
_checkAlbumPriv(aid,callBack);},init:function(aid,lloc){_aid=aid;_lloc=lloc;if(!_checkLoaded(aid)){QZAPP.g_XDoc["temp_album"]=null;}
_checkAlbumPriv(aid,_prepareLoad);},getAlbum:_getAlbum,loadAlbum:_loadAlbum,getPriv:_getPriv,replaceAlbum:_replaceAlbum,getPhotos:function(ref){if(ref||!photos)photos=inner.getCurAlbum(true).selectNodes("pic");return photos;},getCurAlbum:function(ref){if(ref||!curAlbum)curAlbum=_getAlbum(_aid);return curAlbum;},refreshAlbum:function(aid){try{var album=_getAlbum(aid);album.removeAttribute("isLoaded");}catch(e){};},setAlbumCover:function(aid,sloc,cb){if(!checkSessionUin()){return;}
var photos=getPhotos(aid);var idx=getIndexByValue(photos,"sloc",sloc);if(idx==null){return;}
data={uin:QZAPP.g_iUin,refer:getRefer(),albumid:aid,sloc:sloc,nvip:isNVip(),output_type:"jsonhtml"};dataSender(getUrl("set_album_cover"),data,function(){var album=getAlbum(aid);setNodeSubValue(album,"pre",getNodeSubValue(photos[idx],"pre"));setNodeSubValue(album,"url",getNodeSubValue(photos[idx],"url"));setNodeSubValue(album,"cover_id",getNodeSubValue(photos[idx],"sloc"));if(typeof cb=="function"){cb();}});}}})();var RightSetDlg=(function(){var dlg;var inited=false;var right;var inner;return inner={init:function(type){if(!inited){dlg=QZONE.dom.createElementIn("div",document.body,false,{"id":"rightset_div","className":"photo_pupop bor2","style":"width:300px;display:none;position:absolute;","innerHTML":'<div id="right_title" class="photo_pupop_title bgr2"><h4>访问权限设置</h4><button onclick="RightSetDlg.cancel();" class="icon_photo_delete" title="隐藏"><span>隐藏</span></button></div><div class="photo_pupop_main bg"><div class="set_album_restrict"><div class="album_restrict"><label><input type="radio" name="album_restrict" />所有人可见</label><label><input type="radio" name="album_restrict" checked="checked" />需要密码访问</label><div style="display:none;" id="password_right_div" class="album_restrict_pass"><div><strong>输入密码</strong><input maxlength="20" id="password_input" type="password" class="text-input" /></div><div><strong>确认密码</strong><input id="confirm_password_input" maxlength="20" type="password" class="text-input" /><p class="album_restrict_pass_tip">(20个字母或数字以内)</p></div></div><label><input type="radio" name="album_restrict" />仅主人可见</label><p class="photo_point">温馨提示：如果您是QQ校友用户，所有人可见的相册将会在QQ相册和QQ校友显示。</p></div><p class="edit_option_button"><button class="bt_tx2">确认</button><button onclick="RightSetDlg.cancel();" class="bt_tx2">取消</button></p></div></div>'});QZONE.dragdrop.registerDragdropHandler("right_title",dlg,{rangeElement:[QZONE.dom.get(document.body),[1,1,1,1]]});}
if(type==1){$("password_right_div").style.display="";}else{$("password_right_div").style.display="none";}
var cbs=QZONE.dom.getByName("album_restrict","input");for(var i=cbs.length-1;i>=0;i--){if(type==i){cbs[i].checked=true;}else{cbs[i].checked=false;}}
dlg.style.display="";var p=QZONE.dom.getSize(document.body);var d=QZONE.dom.getSize(dlg);dlg.style.left=(p[0]-d[0])/2;dlg.style.top=(p[1]-d[1])/2;inited=true;},cancel:function(){dlg.style.display="none";},submit:function(){},rightClicked:function(type){right=type;switch(right){case 0:case 2:$("password_right_div").style.display="none";break;case 1:$("password_right_div").style.display="";$("confirm_password_input").value="";$("password_input").value="";break;}}}})();var ShareDlg=(function(){var inited=false;var dlg;var mask;function _init(){dlg=document.createElement("div");dlg.id="photo_share_dlg";dlg.className="photo_pupop bor2";dlg.style.width="478px";dlg.style.display="none";dlg.style.zIndex=999999;dlg.innerHTML='<div id="share_title" class="photo_pupop_title bgr2"><h4>复制地址，粘贴给他人，精彩齐分享</h4><button onclick="ShareDlg.hide();" class="icon_photo_delete" title="隐藏"><span>隐藏</span></button></div><div class="photo_pupop_main bg"><div id="photo_share_dlg_main" class="share_album"></div></div>';document.body.appendChild(dlg);QZONE.dragdrop.registerDragdropHandler("share_title",dlg,{rangeElement:[QZONE.dom.get(document.body),[1,1,1,1]]});inited=true;}
var inner;return inner={share:function(){if(!inited){_init();}
var html=[];for(var i=0,iLen=arguments.length;i<iLen;i++){var o=arguments[i];html.push('<p class="share_album_option">'+o.title+'<input type="text" class="text-input" value="'+o.value+'" /><button onclick="ShareDlg.copy(\''+o.value+'\')" class="bt_tx2">复制</button></p>');}
$("photo_share_dlg_main").innerHTML=html.join("");fixHeight();dlg.style.display="";try{var p=QZONE.dom.getPosition(document.body);var d=QZONE.dom.getPosition(dlg);var b=Math.min(QZAPP.document.body.offsetHeight,QZAPP.document.documentElement.offsetHeight);var s=QZFP.getScrollTop();QZONE.dom.setXY(dlg,(p["width"]-d["width"])/2,Math.max(0,Math.min((b-d["height"]+s)/3,p["height"]-d["height"])+p["top"]-30));}catch(e){var p1=QZONE.dom.getPosition(document.body);var p2=QZONE.dom.getPosition(dlg)
QZONE.dom.setXY(dlg,p1.left+(p1.width-p2.width)/2,p1.top+(p1.height-p2.height)/3);}
MaskDlg.show();},hide:function(){dlg.style.display="none";MaskDlg.hide();},copy:function(value){var url="http://"+QZAPP.g_iUin+".qzone.qq.com?url="+escape(window.location.href);var ret=copyToClip(value);if(ret){QZFP.showMsgbox("地址复制成功",null,1500);}else{QZFP.showMsgbox("非ie浏览器暂不支持此功能",null,1500);}
inner.hide();}}})();var XNode=(function(){var inner;return inner={delNodeByValue:function(node,name,value){try{if(getNodeSubValue(node,name).trim()==value){inner.delNode(node);}}catch(e){}},delNode:function(node){node.parentNode.removeChild(node);},setAttribute:function(node,attrName,attrValue){node.setAttribute(attrName,attrValue);},replaceNode:function(s,t){try{s.parentNode.replaceChild(t,s);}catch(e){var root=XMLselectSingleNode(s,"/");var doc=parseXML(root.xml.replace(s.xml,t.xml));return doc;}},getXMLDOM:function(){var xmldomversions=["MSXML2.DOMDocument.5.0","MSXML2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XMLDOM"];for(var i=xmldomversions.length-1;i>=0;i--)
try{return new ActiveXObject(xmldomversions[i]);}catch(ex){}
return document.createElement("XML");}}})()
var CreatAlbum=(function(){var preHeight;var submited=false;var isShow=false;var new_aid,new_name;var album_info_html=function(){return['<div id="ca_title" class="photo_pupop_title bgr2">','<h4>创建相册</h4>','<button class="icon_photo_delete" title="关闭" onclick="CreateAlbum.caClose(1);"><span>关闭</span></button>','</div>','<div class="photo_pupop_main bg">','<div class="create_album">','<table>','<colgroup>','<col style="width:66px;" /><col />','</colgroup>','<thead>','<tr>','<th>输写项名称</th>','<th>输写项</th>','</tr>','</thead>','<tfoot>','<tr>','<td colspan="2">','<p class="edit_option_button">','<button tabindex="6" onclick="CreatAlbum.submitEdit()" class="bt_tx2">确定</button>','<button tabindex="7" onclick="CreatAlbum.caClose();" class="bt_tx2">取消</button>','</p>','</td>','</tr>','</tfoot>','<tbody>','<tr>','<th>相册名称：</th>','<td>','<input tabindex="1" id="ca_name" type="text" class="text-input" onkeydown="if(event.keyCode==13)CreatAlbum.submitEdit()" maxlength="14" onpropertychange="onModChange(this.value, 14, $(CreateAlbum.idMap[4]))"/>','<p class="create_album_tip">您已输入<strong id="ca_name_tip">0</strong>个字符(最多<strong>14</strong>个字符)</p>','</td>','</tr>','<tr>','<th>相册描述：</th>','<td>','<textarea tabindex="2" id="ca_desc" onpropertychange="onModChange(this.value, 150, $(CreateAlbum.idMap[6]))"></textarea>','<p class="create_album_tip">您已输入<strong id="ca_desc_tip">0</strong>个字符(最多<strong>150</strong>个字符)</p>','</td>','</tr>','<tr>','<th>分类：</th>','<td>','<select tabindex="3" id="ca_class">','<option value="101" selected="selected">人物</option>','<option value="102">风景</option>','<option value="103">动物</option>','<option value="104">游记</option>','<option value="105">卡通</option>','<option value="106">生活</option>','<option value="107">其他</option>','</select>','</td>','</tr>','<tr>','<th>访问权限：</th>','<td class="album_restrict">','<label><input type="radio" id="ca_rest_public" name="album_restrict" onclick="CreateAlbum.changePriv(\'all\');" checked="checked" />所有人可见</label>','<label><input type="radio" id="ca_rest_pw" name="album_restrict" onclick="CreateAlbum.changePriv(\'password\');"/>需要密码访问</label>','<div id="ca_pw" class="album_restrict_pass" style="display:none">','<div>','<strong>输入密码</strong>','<input tabindex="4" id="ca_pw_v1" type="password" class="text-input" maxlength="20"/>','</div>','<div>','<strong>确认密码</strong>','<input tabindex="5" id="ca_pw_v2" type="password" class="text-input" maxlength="20" onkeydown="if(event.keyCode==13)CreatAlbum.submitEdit()"/>','<p class="album_restrict_pass_tip">(20个字母或数字以内)</p>','</div>','</div>','<label><input type="radio" id="ca_rest_private" name="album_restrict" onclick="CreateAlbum.changePriv(\'owner\');"/>仅主人可见</label>','</td>','</tr>','<tr>','<th>&nbsp;</th>','<td>','<label for="allow_reprint"><input type="checkbox" checked="checked" name="allow_reprint" id="allow_reprint" class="input_checkbox" /><span id="allow_reprint_tips">允许我的好友转载</span></label>','</td>','</tr>','<tr id="campus_tips">','<th class="album_tips"><span class="c_tx">温馨提示：</span></th>','<td class="album_restrict"><span class="c_tx">如果您是QQ校友用户，所有人可见的相册将会在<a class="unline c_tx" href="http://xiaoyou.qq.com" target="_blank">QQ校友</a>显示。</span></td>','</tr>','</tbody>','</table>','</div>','</div>'].join("");}
var check_dlg_html=function(){return['<div id="cac_tital" class="photo_pupop_title bgr2">','<h4>创建相册</h4>','<button class="icon_photo_delete" onclick="CreatAlbum.cancelUp()" title="隐藏"><span>隐藏</span></button>','</div>','<div class="photo_pupop_main bg">','<div class="create_album_tip">','<p class="create_album_tip_text">相册<strong id="cac_name">普罗旺斯之旅</strong>创建成功，是否马上上传照片到这个相册？</p>','<p class="edit_option_button">','<button onclick="CreatAlbum.uploadPic()" class="bt_tx2">是</button>','<button onclick="CreatAlbum.cancelUp()" class="bt_tx2">否</button>','</p>','</div>','</div>'].join("");}
var _idMap={1:"ca_div",2:"ca_title",3:"ca_name",4:"ca_name_tip",5:"ca_desc",6:"ca_desc_tip",7:"ca_class",8:"ca_rest_public",9:"ca_rest_pw",10:"ca_pw",11:"ca_pw_v1",12:"ca_pw_v2",13:"ca_rest_private",14:"cac_div",15:"cac_tital",16:"cac_name"};function checkValue()
{if(!checkInput("name",$(_idMap[3]).value))
{$(_idMap[3]).select();return false;}
if(!checkInput("desc",$(_idMap[5]).value))
{$(_idMap[5]).select();return false;}
if($(_idMap[9]).checked)
{if($(_idMap[11]).value.length<=0)
{alert("密码不能为空，请重新输入！");$(_idMap[11]).select();return false;}
if($(_idMap[11]).value!=$(_idMap[12]).value)
{alert("您两次输入密码不相同，请重新输入！");$(_idMap[11]).select();return false;}}
return true;};function showCheckDlg(){var div=$(_idMap[14]);if(!div){div=document.createElement("div");document.body.appendChild(div);div.id=_idMap[14];div.className="photo_pupop bor2";div.style.width="284px";div.style.zIndex="1000";$hideObj(div);div.innerHTML=check_dlg_html();QZONE.dragdrop.registerDragdropHandler($(_idMap[15]),div,{rangeElement:[QZONE.dom.get(document.body),[1,1,1,1]]})}
inner.caClose();$show(div);MaskDlg.show();var p1=QZONE.dom.getPosition(document.body);var p2=QZONE.dom.getPosition($(_idMap[1]));if(p2.height>p1.height){QZEONE.dom.setSize(document.body,p1.width,p2.height+100);}
QZONE.dom.setXY(div,p1.left+(p1.width-p2.width)/2,50);$(_idMap[16]).innerHTML=new_name;};var inner;return inner={init:function(tof){if(!checkSessionUin(true)){return;}
isShow=tof;var div=$(_idMap[1]);if(!div){div=document.createElement("div");document.body.appendChild(div);div.id=_idMap[1];div.className="photo_pupop bor2";div.style.width="520px";div.style.zIndex="1000";}
div.innerHTML=album_info_html();$show(div);MaskDlg.show();if(QZONE.FP.getBitMapFlag(7)){$("allow_reprint").parentNode.parentNode.parentNode.style.display="none";$("allow_reprint").checked=false;}
var p1=QZONE.dom.getPosition(document.body);var p2=QZONE.dom.getPosition(div)
QZONE.dom.setXY(div,p1.left+(p1.width-p2.width)/2,50);var p1=QZONE.dom.getPosition(document.body);preHeight=p1.height;var p2=QZONE.dom.getPosition(div)
if(p2.height>p1.height){QZEONE.dom.setSize(document.body,p1.width,p2.height+100);}
QZONE.dragdrop.registerDragdropHandler($(_idMap[2]),$(_idMap[1]),{rangeElement:[QZONE.dom.get(document.body),[1,1,1,1]]})},idMap:_idMap,show:function(type){$show(_idMap[type]);$hide("campus_tips");var p1=QZONE.dom.getPosition(document.body);var p2=QZONE.dom.getPosition($(_idMap[1]));if((p2.top+p2.height)>p1.height){QZONE.dom.setSize(document.body,p1.width,p2.height+100+p2.top);}},hide:function(type,bOpen){$hide(_idMap[type]);if(typeof bOpen!="undefined"&&bOpen){$show("campus_tips");}else{$hide("campus_tips");}
var p1=QZONE.dom.getPosition(document.body);var p2=QZONE.dom.getPosition($(_idMap[1]));if((p2.top+p2.height)>p1.height){QZONE.dom.setSize(document.body,p1.width,p2.height+100+p2.top);}},getNewAid:function(){return new_aid;},uploadPic:function(){Media.upload(new_aid);MaskDlg.hide();},cancelUp:function(){qz_go_imc("photo_list.htm",new_aid);MaskDlg.hide();},caClose:function(){inner.hide(1);MaskDlg.hide();},cacClose:function(){qz_go_imc("photo_list.htm",new_aid);MaskDlg.hide();},submitEdit:function(){if((!checkValue())||submited)return;submited=true;var priv;if($(_idMap[8]).checked){priv=1;}else if($(_idMap[9]).checked){priv=2;}else{priv=3;}
var data=["uin="+QZAPP.g_iLoginUin,"refer="+getRefer(),"albumname="+$(_idMap[3]).value.URIParam(),"albumdesc="+$(_idMap[5]).innerHTML.trim().unHtmlReplace().URIencode(),"albumclass="+$(_idMap[7]).value,"priv="+priv,"bitmap="+($("allow_reprint").checked?"10000000":"10000001"),"password="+MD5($(_idMap[11]).value.unHtmlLeftB(20)),"password2="+MD5($(_idMap[12]).value.unHtmlLeftB(20)),"nvip="+isNVip()].join("&");var callBack=function(){submited=false;if(checkRetXml(QZAPP.g_XDoc["add_album"],true)){QPHOTO.album.refresh(QZAPP.g_iLoginUin);try{var doc=QZAPP.g_XDoc["add_album"].selectSingleNode("/data/album");var albums=QZAPP.g_XDoc[16].selectSingleNode("/data");albums.appendChild(doc);}catch(e){QZAPP.g_XDoc[16]=null;}
new_aid=getNodeSubValue(doc,"id");new_name=getNodeSubValue(doc,"name");PhotoList.refreshAlbum(new_aid);if(!isShow){CreatAlbum.caClose();QZFP.showMsgbox("创建相册成功!",0,1500);CreatAlbum.uploadPic();}
else{showCheckDlg();}}}
var url;if(QPHOTO.util.getUrl){url=QPHOTO.util.getUrl("album_add");}else{url=getUrl("album_add");}
QPHOTO.util.loadXMLAsync("add_album",url,callBack,callBack,true,data);},changePriv:function(_t){var _cb=$("allow_reprint");if(_t=="all"){CreateAlbum.hide(10,true);_cb.disabled=false;QZONE.css.removeClassName($("allow_reprint_tips"),"c_tx3");}else if(_t=="password"){CreateAlbum.show(10);_cb.checked=false;_cb.disabled=true;QZONE.css.addClassName($("allow_reprint_tips"),"c_tx3");}else{CreateAlbum.hide(10,false);_cb.checked=false;_cb.disabled=true;QZONE.css.addClassName($("allow_reprint_tips"),"c_tx3");}}}})();var CreateAlbum=CreatAlbum;var PasswordDlg=(function(){var dlg;var img;var inited=false;function _init(){dlg=QZONE.dom.createElementIn("div",document.body,false,{"id":"password_div","className":"photo_pupop bor2","style":"top:0px;width:300px;display:none;position:absolute;","innerHTML":'<div id="password_title" class="photo_pupop_title bgr2"><h4>输入访问密码</h4><button onclick="PasswordDlg.hide();" class="icon_photo_delete" title="隐藏"><span>隐藏</span></button></div><div class="photo_pupop_main bg"><div class="import_visit_password"><p>此相册需要密码访问</p><p class="import_visit_option"><strong>输入密码</strong><input id="album_passwd" type="password" class="text-input" maxlength="20" onKeyPress="javascript:if (event.keyCode == 13) return PasswordDlg.submit();"/></p><p class="import_visit_option"><strong>验证码</strong><input id="input_verifycode" type="text" class="text-input" /></p><p class="visit_verify_img"><img src="about:blank" id="verifycodeImg" onClick="PasswordDlg.changeVerify(id,\'input_verifycode\')" alt="看不清楚请点击换一张" style="cursor:pointer;vertical-align:top"/></p><p class="import_visit_verify"><a href="javascript:;" onClick="PasswordDlg.changeVerify(\'verifycodeImg\',\'input_verifycode\',1);return false">看不清楚，换一张</a></p><p class="edit_option_button"><button onclick="PasswordDlg.submit();" class="bt_tx2">确认</button><button onclick="PasswordDlg.hide();" class="bt_tx2">取消</button></p></div></div>'});img=$("verifycodeImg");QZONE.dragdrop.registerDragdropHandler("password_title","password_div",{rangeElement:[QZONE.dom.get(document.body),[1,1,1,1]]});dlg.style.zIndex=99999;inited=true;}
var inner;return inner={show:function(){if(!inited){_init();}
fixHeight();img.src="http://ptlogin2.qq.com/getimage?aid=15000501&"+Math.random();dlg.style.display="";try{var p=QZONE.dom.getPosition(document.body);var d=QZONE.dom.getPosition(dlg);var b=Math.min(QZAPP.document.body.offsetHeight,QZAPP.document.documentElement.offsetHeight);var s=QZFP.getScrollTop();QZONE.dom.setXY(dlg,(p["width"]-d["width"])/2,Math.max(0,Math.min((b-d["height"]+s)/2-50,p["height"]-d["height"])+p["top"]-30));}catch(e){var p1=QZONE.dom.getPosition(document.body);var p2=QZONE.dom.getPosition(dlg)
QZONE.dom.setXY(dlg,p1.left+(p1.width-p2.width)/2,p1.top+(p1.height-p2.height)/3);}
MaskDlg.show();},hide:function(){MaskDlg.hide();dlg.style.display="none";},submit:function(){if(window.passwdSubmit){window.passwdSubmit();}},changeVerify:function(vid,inputid,timeout){timeout=(!timeout)?200:timeout;if(event&&event.srcElement==document.getElementById(vid)&&event.type!="error")
$(vid).src="http://ptlogin2.qq.com/getimage?aid=15000501&"+Math.random();else
setTimeout('$("'+vid+'").src = "http://ptlogin2.qq.com/getimage?aid=15000501&"+Math.random()',timeout);$(inputid).value="";},refresh:function(){img.src="http://ptlogin2.qq.com/getimage?aid=15000501&"+Math.random();try{$("input_verifycode").value="";$("album_passwd").value="";}catch(e){};}}})();﻿var MaskDlg=(function(){var ifrm;var mask;var inner;return inner={show:function(){if(!mask){mask=document.createElement("div");ifrm=document.createElement("iframe");mask.appendChild(ifrm);mask.className="pupop_layer bg2";document.body.appendChild(mask);}
var p=QZONE.dom.getPosition(document.body);ifrm.style.height=p["height"];mask.style.height=p["height"];fixHeight();},hide:function(){ifrm.style.height="0px";mask.style.height="0px";fixHeight();}}})();var AlbumAttr=(function(){var _aid,_album;var _getPrivHtml=function(){return['<div id="pm_title" class="photo_pupop_title bgr2">','<h4>访问权限设置</h4>','<button class="icon_photo_delete" title="隐藏" onclick="AlbumAttr.privModClose()"><span>隐藏</span></button>','</div>','<div class="photo_pupop_main bg">','<div class="set_album_restrict">','<div class="album_restrict">','<label><input type="radio" onclick="AlbumAttr.hide(6);" id="pm_rest_public" name="album_restrict" checked="checked" />所有人可见</label>','<label><input type="radio" onclick="AlbumAttr.show(6);" id="pm_rest_pw" name="album_restrict" />需要密码访问</label>','<div id="pm_pw" class="album_restrict_pass">','<div>','<strong>输入密码</strong>','<input type="password" id="pm_pw_v1" class="text-input" maxlength="20"/>','</div>','<div>','<strong>确认密码</strong>','<input type="password" id="pm_pw_v2" class="text-input" maxlength="20" onkeydown="if(event.keyCode==13)AlbumAttr.privModSumit()"/>','<p class="album_restrict_pass_tip">(20个字母或数字以内)</p>','</div>','</div>','<label><input type="radio" onclick="AlbumAttr.hide(6);"  id="pm_rest_private" name="album_restrict" />仅主人可见</label>','</div>','<p class="edit_option_button"><button class="bt_tx2" onclick="AlbumAttr.privModSumit()">确认</button><button class="bt_tx2" onclick="AlbumAttr.privModClose()">取消</button></p>','</div>','</div>'].join("");}
var _idMap={1:"pm_rest_public",2:"pm_rest_pw",3:"pm_rest_private",4:"pm_title",5:"pm_div",6:"pm_pw",7:"pm_pw_v1",8:"pm_pw_v2"};var _urlMap={2:"/ac/qzone_v5/photo/need_pass.gif",3:"/ac/qzone_v5/photo/only_me.gif",4:"/ac/qzone_v5/photo/no_photo_s.gif"};var _getPriv=function(){var priv=parseInt(getNodeSubValue(_album,"priv"));if(isNaN(priv)||priv<1||priv>3){priv=1;}
return priv;};var inner;return inner={privModDlg:function(aid){var _e=QZONE.event.getEvent();if(!User.isOwner()){return;}
if(!checkSessionUin(true)){return;}
_aid=aid;_album=getAlbum(_aid);var div;div=$(_idMap[5]);if(!div){div=document.createElement("div");document.body.appendChild(div);$hide(div);div.id=_idMap[5];div.className="photo_pupop bor2";div.style.width="300px";div.style.zIndex="1000";div.innerHTML=_getPrivHtml();QZONE.dragdrop.registerDragdropHandler($(_idMap[4]),div,{rangeElement:[QZONE.dom.get(document.body),[1,1,1,1]]});}
var priv=_getPriv();$(_idMap[priv]).checked="checked";if(priv==2){$show(_idMap[6]);}else{$hide(_idMap[6]);}
$(_idMap[7]).value="";$(_idMap[8]).value="";MaskDlg.show();$show(div);var p1=QZONE.dom.getPosition(document.body);var p2=QZONE.dom.getPosition(div)
if(VersionInfo.qzoneMode()==1){if(ua.ie){var p=QZONE.dom.getPosition(_e.srcElement);QZONE.dom.setXY(div,p1.left+(p1.width-p2.width)/2,p.top-p2.height);}else{QZONE.dom.setXY(div,p1.left+(p1.width-p2.width)/2,_e.pageY-p2.height);}}else{QZONE.dom.setXY(div,p1.left+(p1.width-p2.width)/2,_e.clientY-p2.height);}},privModClose:function(){$hide(_idMap[5]);MaskDlg.hide();},privModSumit:function(){var priv,pw1,pw2;for(var i=1;i<4;i++){if($(_idMap[i]).checked){priv=i;break;}}
pw1=$(_idMap[7]).value;pw2=$(_idMap[8]).value;var callBack=function(){Page.getAlbumList().show();AlbumAttr.privModClose();}
inner.privMod(_aid,priv,pw1,pw2,callBack);},privMod:function(aid,priv,pw1,pw2,cb){aid=aid.trim();pw1=pw1.trim();pw2=pw2.trim();if(typeof(cb)!="function"){cb=QZONE.emptyFn;}
if(priv==2){if(pw1==""){alert("密码不能为空，请输入密码");return false;}
if(pw1!=pw2){alert("您两次输入密码不相同，请重新输入！");return false;}}
var url=getUrl("album_mod");var callBack=function(){if(checkRetXml(QZAPP.g_XDoc["edit_ret"],true)){clearNewPhoto();QZFP.showMsgbox("权限修改成功",0,1500);var album=getAlbum(aid);album.removeAttribute("isLoaded");PhotoList.reload(aid);setNodeSubValue(album,"priv",priv);if(getNodeSubValue(album,"total")==0){setNodeSubValue(album,"pre",_urlMap[4]);}else if(priv>1){setNodeSubValue(album,"pre",_urlMap[priv]);}
cb();}}
var errBack=function(){alert("失败");}
var data=["type=4","priv="+priv,"uin="+QZAPP.g_iUin,"refer="+getRefer(),"albumid="+aid.URIencode(),"password="+MD5(pw1.unHtmlLeftB(20)).URIencode(),"password2="+MD5(pw2.unHtmlLeftB(20)).URIencode(),"nvip="+isNVip()].join("&");QZAPP.g_XDoc["edit_ret"]=null;QPHOTO.util.loadXMLAsync("edit_ret",url,callBack,errBack,true,data);},show:function(type){$show(_idMap[type]);},hide:function(type){$hide(_idMap[type]);},getInfo:function(aid){var album=getAlbum(aid);var checkPriv=function(p){p=parseInt(p);if(isNaN(p)||p<1||p>3){p=1;}
return p;}
var data={aid:getNodeSubValue(album,"id"),name:getNodeSubValue(album,"name"),desc:getNodeSubValue(album,"desc"),pre:getNodeSubValue(album,"pre"),url:getNodeSubValue(album,"url"),total:getNodeSubValue(album,"total"),brower:getNodeSubValue(album,"borwer"),priv:checkPriv(getNodeSubValue(album,"priv"))}
return data;}}})();var Dialog=(function(){var _aid,_other;var inner;return inner={show:function(settings){var set=settings||{};setDefault=function(key,value){if(set[key]==null||set[key]==""){set[key]=value}}
setDefault("title","提示");setDefault("type",null);setDefault("msg",null);setDefault("link",null);setDefault("btn",null);setDefault("code",null);setDefault("ohters",null);setDefault("callBack",QZONE.emptyFn);var data=[];if(set.type)data.push("type="+set.type);if(set.msg)data.push("msg="+set.msg);if(set.link)data.push("link="+set.link);if(set.btn)data.push("btn="+set.btn);if(set.code)data.push("code="+set.code);if(set.others)data.push(set.others);data=data.join("&");var strHTML='<iframe id="upload_dialog" frameborder="0" src="'+g_PhotoImgcacheHtdocsPath+'qzone_v4/dialog.htm#'+data+'" style="width:100%;height:115px"></iframe>';QZFP.popupDialog(set.title,strHTML,300,115);var setCallBack=function(){QZAPP.window.popupCallback=function(){switch(QZAPP.window.popupData){case"actUp":Media.activeXUpload();break;case"reg":openVipPage();;default:set.callBack(QZAPP.window.popupData);}
QZAPP.window.popupData=null;}}
setTimeout(setCallBack,100);},activexUpdate:function(aid,other){_aid=aid;_other=other
var cb=function(type){switch(type){case"ok":QZAPP.location.href=g_PhotoImgcacheHtdocsPath+"qzone_v4/activex_setup.htm";refreshPing(2,7);break;case"cancel":default:Media.simpleUpload(aid,other);refreshPing(2,3);}}
Dialog.show({title:"极速上传工具安装",type:9,callBack:cb})},activexUpdate230:function(aid,other){_aid=aid;_other=other
var cb=function(type){switch(type){case"ok":QZAPP.location.href=g_PhotoImgcacheHtdocsPath+"qzone_v4/activex_setup230.htm";refreshPing(2,7);break;case"cancel":default:Media.simpleUpload(aid,other);refreshPing(2,3);}}
Dialog.show({title:"极速上传工具安装",type:9,callBack:cb})}}})();var g_drawExVersion=109;var g_drawVersion=106;var g_FlashVersion=10;var Media=(function(){function _checkUinList(){if(QZONE.FP.getQzoneConfig().loginUin==468214434){return true};var _list={0:true,1:true,2:true};if(QZONE.FP.getQzoneConfig().loginUin==0){return false};if(_list[QZONE.FP.getQzoneConfig().loginUin%10]){return true};return false;}
var inner;return inner={getActiveXVersion:function(name){try{if(ua.firefox&&ua.windows){var key="v_"+name;var v=inner[key];if(typeof v=='undefined'){inner[key]=0;var o=QZFL.dom.createElementIn("object",document.body,false,{type:"application/tencent-qqphotodrawex2-plugin",style:"width:1px;height:1px;"});try{o.CreateAX("QQPhotoDrawEx.dll");v=o.GetVersion();}catch(e){o.style.display="none";QZFL.dom.removeElement(o);try{o=QZFL.dom.createElementIn("object",document.body,false,{type:"application/tencent-qqphotodrawex-plugin",style:"width:1px;height:1px;"});o.CreateAX("QQPhotoDrawEx.dll");v=o.GetVersion();}
catch(e){v=0;}}
o.style.display="none";QZFL.dom.removeElement(o);inner[key]=v;}
return v;}else if(ua.webkit&&ua.windows){var key="v_"+name;var v=inner[key];if(typeof v=='undefined'){inner[key]=0;var o=QZFL.dom.createElementIn("object",document.body,false,{type:"application/tencent-qqphotodrawex2-plugin",style:"width:1px;height:1px;"});try{o.CreateAX("QQPhotoDrawEx.dll");v=o.GetVersion();}
catch(e){v=0;}
o.style.display="none";QZFL.dom.removeElement(o);inner[key]=v;}
return v;}else if(window.ActiveXObject){if(!name)name="QQPhotoDraw.PhotoDraw.1.1";var t=new ActiveXObject(name);var v=parseInt(t.GetVersion());return v;}else{return-1;}}catch(e){return 0;}},getDrawVersion:function(){return inner.getActiveXVersion("QQPhotoDraw.PhotoDraw.1.1");},getDrawExVersion:function(){if(!inner.getDrawExSupported()){return-1;}
return inner.getActiveXVersion("QQPhotoDrawEx.PhotoDrawEx.1");},getFlashVersion:function(){return QZONE.media.getFlashVersion().toNumber();},getDrawExSupported:function(){var showNew=_checkUinList();if(ua.ie){return true;}else if(ua.webkit&&ua.windows&&showNew){return true;}else if(ua.firefox&&ua.windows&&(ua.windows<6.1||showNew)){return true;}
return false;},activeXEdit:function(aid,url){var v=Media.getDrawVersion();if(v>=g_drawVersion){var data=["a_id="+aid,"famous="+QZFP.getBitMapFlag(7),"style_id="+QZAPP.g_StyleID,"mydomain="+QZAPP.g_PhotoUserDomain.nu,"url="+url];showModalDialog("/qzone/client/photo/pages/showUploadMulti.html?"+data.join("&"),QZAPP.g_XDoc[16],"scroll:no;status:yes;dialogWidth:650px;dialogHeight:535px;");PhotoList.refreshAlbum(aid);qz_go_imc('photo_list.htm',aid);return 1;}else if(v==-1){alert("您的浏览器似乎不支持ActiveX插件，因此无法安装相片上传工具。\n如您希望安装相片上传工具，请使用IE浏览器并打开支持ActiveX插件选项。");return-110;}else if(v==0){window.open("/qzone/client/photo/pages/cab_install.htm");return-120;}else{window.open("/qzone/client/photo/pages/cab_install.htm");return-130;}},activeXUpload:function(aid,others,type){if(!checkSessionUin()){return;}
function _checkUinList(){var _list={0:true,1:true,2:true};if(QZONE.FP.getQzoneConfig().loginUin==0){return false};if(_list[QZONE.FP.getQzoneConfig().loginUin%10]){return true};return false;}
if(_checkUinList()&&ua.webkit&&ua.windows){var v=Media.getDrawExVersion();if(v>=g_drawExVersion){qz_go_imc("upload_activex.htm",aid,null,others);return 0;}else if(type==null||type==0){Dialog.activexUpdate230(aid,others);}else if(type==1){QZAPP.location.href=g_PhotoImgcacheHtdocsPath+"qzone_v4/activex_setup230.htm";}
return 1;}else{if(!(ua.ie||ua.firefox)&&type!=-1){var _c=new QZONE.FP._t.QZFL.widget.Confirm("温馨提示",'糟糕...目前极速上传还不支持您这款浏览器，请换用IE类浏览器打开这个页面，或使用普通上传。',QZONE.widget.Confirm.TYPE.OK);_c.tips[0]='确定';_c.show();return;}}
var v=Media.getDrawExVersion();if(v>=g_drawExVersion){qz_go_imc("upload_activex.htm",aid,null,others);return 0;}else if(type==null||type==0){Dialog.activexUpdate(aid,others);}else if(type==1){QZAPP.location.href=g_PhotoImgcacheHtdocsPath+"qzone_v4/activex_setup.htm";}
return 1;},flashUpload:function(aid,others){if(!checkSessionUin(true)){return;}
v=Media.getFlashVersion();if(v>=g_FlashVersion){qz_go_imc("upload_flash.htm",aid,null,others);return 0;}else if(v==0){return 1;}else{return 2;}},webUpload:function(aid,others){if(!checkSessionUin(true)){return;}
qz_go_imc("upload_web.htm",aid,null,others);return 0;},simpleUpload:function(aid,others){if(!checkSessionUin(true)){return;}
if(inner.flashUpload(aid,others)!=0){inner.webUpload(aid,others);}},upload:function(aid,others){if(!checkSessionUin()){return;}
if(inner.activeXUpload(aid,others,-1)!=0){inner.simpleUpload(aid,others);};}}})();var QPHOTO=QPHOTO||{};QPHOTO.emptyFn=function(){};QPHOTO.setDef=function(map,key,value){if(map&&map[key]==null){map[key]=value;}};QPHOTO.inPengyou=QZONE.FP.isInPengyou&&QZONE.FP.isInPengyou();QPHOTO.inQzone=!QPHOTO.inPengyou;QPHOTO.refer=QPHOTO.inPengyou?'campus':'qzone';QPHOTO.plat=QPHOTO.inPengyou?'pengyou':'qzone';QPHOTO.g_JData=QZAPP.g_JData
QPHOTO.g_XDoc=QZAPP.g_XDoc
QPHOTO.loadJSON=(function(){var _setDef=QPHOTO.setDef;var _param;var _callback=function(){var args=arguments;if(_param.cDFn(QPHOTO.g_JData[_param.xId])==false){_param.errCb(args);}else{_param.sucCb(args);}}
var _send2=function(){_param.errCb=_param.errCb.parent||_param.errCb;var p=_param;QPHOTO.util.loadJsonData(p.xId,p.url2,_callback,p.errCb,true,p.charset,p.cFn);}
var _send=function(){var p=_param;QPHOTO.util.loadJsonData(p.xId,p.url,_callback,p.errCb,p.refresh,p.charset,p.cFn);}
return function(parameter){_param=parameter||{};_setDef(_param,"url2",null);_setDef(_param,"cDFn",QPHOTO.emptyFn);_setDef(_param,"errCb",QPHOTO.emptyFn);if(_param.url2){$extend(_param,{errCb:_send2})}
_send();}})();QPHOTO.loadXML=(function(){var _setDef=QPHOTO.setDef;var _param;var _callback=function(){var args=arguments;if(_param.cDFn(QPHOTO.g_XDoc[_param.xId])==false){_param.errCb(args);}else{_param.sucCb(args);}}
var _send2=function(){_param.errCb=_param.errCb.parent||_param.errCb;var p=_param;QPHOTO.util.loadXMLAsync(p.xId,p.url2,_callback,p.errCb,true,p.data,p.returnType);}
var _send=function(){var p=_param;QPHOTO.util.loadXMLAsync(p.xId,p.url,_callback,p.errCb,p.refresh,p.data,p.returnType);}
return function(parameter){_param=parameter||{};_setDef(_param,"url2",null);_setDef(_param,"data",null);_setDef(_param,"refresh",false);_setDef(_param,"cDFn",QPHOTO.emptyFn);_setDef(_param,"errCb",QPHOTO.emptyFn);if(_param.url2){$extend(_param,{errCb:_send2})}
_send();}})();QPHOTO.user=(function(){var _setDef=QPHOTO.setDef;var _get18Name=function(param){try{var node=QPHOTO.news.getData({uin:param.uin});var name=getNodeSubValue(node.selectSingleNode("/data"),"ownername").trim();if(name!=""){return name;}}catch(e){}
return null;};var _get16Name=function(param){try{var node=QPHOTO.g_XDoc[16];var name=getNodeSubValue(node.selectSingleNode("/data/left/album"),"ownername").trim();if(name!=""){return name;}}catch(e){}
return null;};var inner;return inner={getUin:function(){return QZAPP.g_iUin;},getLoginUin:function(){return QPHOTO.inPengyou?QZAPP.checkLogin():QZFP.checkLogin();},isOwner:function(){return inner.getUin()==inner.getLoginUin();},getName:function(parameter){var param=parameter||{};var name=_get18Name(param)||_get16Name()||inner.getUin();return name;}}})();QPHOTO.domain=(function(){var _setDef=QPHOTO.setDef;var _dataCenter=QPHOTO.g_JData;var _data;var _getDomain=function(param){QPHOTO.loadJSON({xId:param.key,url:QPHOTO.inPengyou?"http://app.photo.pengyou.com/cgi-bin/app/cgi_get_route?uin="+param.uin+"&refer=campus&output_type=json&domain=pengyou":"http://route.store.qq.com/GetRoute?UIN="+param.uin+"&type=json&version=2",url2:"http://rb.store.qq.com/GetRoute?UIN="+param.uin+"&type=json&version=2",cDFn:_check.bind(param),sucCb:param.sucCb,errCb:param.errCb,charset:"gb2312",cFn:QPHOTO.inPengyou?"_Callback":"photoDomainNameCallback"});}
var _check=function(data,param){try{param=param||this;if(data&&(!data.error)&&data.uin==param.uin){var _i=data.idcno;var _d=QZAPP.photoPolicyData.domain;var _k;if(_d){_k=_d[_i];}
if(data.domain){_k=_k||data.domain["default"];}
var regexp=QPHOTO.inPengyou?/pengyou\.com/:/qq\.com/;_data=data[_k]||data;if(_data.r.match(regexp)&&_data.u.match(regexp)&&_data.nu.match(regexp)&&_data.p.match(regexp)&&_data.s.match(regexp)){return true;}else{return false;}}else{return false;}}catch(e){return false;}}
var inner;return inner={get:function(parameter){var param=parameter||{};_setDef(param,"key","user_domain_"+param.uin);_setDef(param,"sucCb",QPHOTO.emptyFn);_setDef(param,"errCb",QPHOTO.emptyFn);_getDomain(param);},getData:function(parameter){var param=parameter||{};_setDef(param,"key","user_domain_"+param.uin);var data=_dataCenter[param.key];var d=null;if(_check(data,param)){d={};$extend(d,_data);}
return d;},set:function(parameter){var param=parameter||{};_setDef(param,"key","user_domain_"+param.uin);_setDef(param,"value",{});_dataCenter[param.key]=param.value;},clear:function(parameter){var param=parameter||{};_setDef(param,"key","user_domain_"+param.uin);_dataCenter[param.key]=null;}}})();QPHOTO.url=(function(){var _setDef=QPHOTO.setDef;var _gu=function(param){var domain=QPHOTO.domain.getData({uin:param.uin});if(!domain){return null;}
var common_url_nu="http://"+domain.nu+"/cgi-bin/common/";var common_url_r="http://"+domain.r+"/cgi-bin/common/";var common_url_u="http://"+domain.u+"/cgi-bin/upload/";var url;var suffix="uin="+param.uin+"&refer="+param.refer;switch(param.name){case"main":url="http://"+param.uin+".photo.qq.com";break;case"main_xml_static":url="http://"+domain.p.replace("sznewp","alist").replace("xanewp","xalist")+"/fcgi-bin/fcg_list_album?"+suffix;break;case"main_xml_cgi":url=common_url_nu+"cgi_list_album?"+suffix;break;case"album_migrated_static":url="http://"+domain.s.replace("static","plist")+"/fcgi-bin/fcg_list_photo?uin="+param.uin+"&albumid="+param.aid;break;case"album_add":url=common_url_nu+"cgi_add_album?"+suffix;break;case"album_mod":url=common_url_nu+"cgi_modify_album?"+suffix;break;case"album_mod_name":url=common_url_nu+"cgi_modify_album?type=1&"+suffix;break;case"album_mod_desc":url=common_url_nu+"cgi_modify_album?type=2&"+suffix;break;case"album_mod_class":url=common_url_nu+"cgi_modify_album?type=3&"+suffix;break;case"album_mod_pri":url=common_url_nu+"cgi_modify_album?type=4&"+suffix;break;case"album_del":url=common_url_nu+"cgi_del_album?"+suffix;break;case"album_view_private":url=common_url_nu+"cgi_view_album?"+suffix;break;case"pic_mod_name":url=common_url_nu+"cgi_modify_pic?type=1&"+suffix;break;case"pic_mod_desc":url=common_url_nu+"cgi_modify_pic?type=2&"+suffix;break;case"pic_mod_tag":url=common_url_nu+"cgi_modify_pic?type=3&"+suffix;break;case"pic_del":url=common_url_nu+"cgi_del_pic?"+suffix;break;case"pic_mul_del":url=common_url_nu+"cgi_delpic_multi?"+suffix;break;case"pic_move":url=common_url_nu+"cgi_move_pic?"+suffix;break;case"pic_edit":url=common_url_nu+"cgi_modify_multipic?"+suffix;break;case"set_album_cover":url=common_url_nu+"cgi_set_albumcover?"+suffix;break;case"pic_upload":url=common_url_u+"cgi_upload_pic";break;case"pic_up_diary":url=common_url_u+"cgi_upload_illustrated";break;case"pic_up_activex":url=common_url_u+"cgi_upload_activex";break;case"pic_up_famous":url=common_url_u.replace(/up\.photo\.qq\.com/,"famousup.photo.qq.com")+"cgi_upload_pic";break;case"pic_up_diary_famous":url=common_url_u.replace(/up\.photo\.qq\.com/,"famousup.photo.qq.com")+"cgi_upload_illustrated";break;case"pic_up_activex_famous":url=common_url_u.replace(/up\.photo\.qq\.com/,"famousup.photo.qq.com")+"cgi_upload_activex";break;case"sort_pic":url=common_url_nu+"cgi_sort_pic?"+suffix;break;case"set_qzone_cover":url=common_url_nu+"cgi_set_usercover?"+suffix;break;case"get_cmt":url="http://app.photo.qq.com/cgi-bin/app/cgi_pcomment_xml?"+suffix;break;case"add_cmt":url=common_url_r+"cgi_add_piccomment?"+suffix;break;case"del_cmt":url=common_url_r+"cgi_del_piccomment?"+suffix;break;case"recent_cmt":url="http://app.photo.qq.com/cgi-bin/app/cgi_recent_cmt_list?"+suffix;break;case"add_reply":url=common_url_r+"cgi_add_reply";break;case"pic_alarm":url=common_url_nu+"cgi_pic_impeach";break;case"bulletin":url=g_PhotoImgcachePath+"pages/qzone_v4/bulletin.xml";break;case"refresh_space":url=common_url_nu+"cgi_adjust_disk";break;case"client_query":url=common_url_nu+"cgi_client_query";break;case"list_marked":url=common_url_r+"cgi_list_mymark?uin="+param.uin;break;case"list_pic_marks":url=common_url_r+"cgi_list_picmark?"+suffix;break;case"add_mark":url=common_url_nu+"cgi_add_picmark";break;case"del_mark":url=common_url_r+"cgi_del_picmark";break;case"check_marked":url=common_url_r+"cgi_check_mymark";break;case"del_marked":url=common_url_r+"cgi_del_mymark";break;case"vphoto_list":url=common_url_r+"cgi_flash_list?"+suffix;break;case"vphoto_del":url=common_url_r+"cgi_flash_delete?"+suffix;break;case"vphoto_set_cover":url=common_url_nu+"cgi_flash_cover";break;case"vphoto_update":url=common_url_r+"cgi_flash_update";break;case"vphoto_cmt_list":url=common_url_r+"cgi_list_flashphotocmt?"+suffix;break;case"vphoto_cmt_add":url=common_url_r+"cgi_add_flashphotocmt?"+suffix;break;case"vphoto_cmt_del":url=common_url_r+"cgi_del_flashphotocmt?"+suffix;break;case"check_avatar":url="http://mall2.qzone.qq.com/fcg-bin/v3/fcg_check_bighead_album?uin="+param.uin;break;case"avatar_list":url="http://mall2.qzone.qq.com/fcg-bin/v3/fcg_show_bighead_album?uin="+param.uin;break;case"upload_web":url=common_url_u+"cgi_upload_pic";break;case"set_indivalbum":url=common_url_nu+"cgi_set_indivalbum";break;case"refresh_tips":url=common_url_nu+"cgi_refresh_tips";break;}
return url;}
var inner;return inner={get:function(parameter){var param=parameter||{};_setDef(param,"key",param.name+"_"+param.uin);_setDef(param,"refer","qzone");return _gu(param);}}})();QPHOTO.util=(function(){var imgcacheDomain=QZONE.FP._t.imgcacheDomain;var frame=window;window.callBackHsmp=[];if(!ua.ie){frame=QZAPP;QZAPP.callBackHsmp=QZAPP.callBackHsmp||[];window.callBackHsmp=QZAPP.callBackHsmp;}
function getACSRFToken(){var hash=5381;var str=QZFL.cookie.get("skey");for(var i=0,len=str.length;i<len;++i){hash+=(hash<<5)+str.charCodeAt(i);}
return hash&0x7fffffff;}
function loadXMLAsync(xID,xUrl,callback,err_callback,nocache,data,returnType){if(xUrl.indexOf("g_tk=")==-1){if(xUrl.indexOf("?")!=-1){xUrl+=("&g_tk="+getACSRFToken());}else{xUrl+=("?g_tk="+getACSRFToken());}}
if(xUrl.indexOf("?")!=-1){xUrl+='&json_esc=1';}else{xUrl+='?json_esc=1';}
var m=xUrl.match(/(^http:\/\/([a-z,A-Z,0-9,\-,_,\.]+\.qq\.com)\/)/);if(!m){alert("不能访问非qq.com域的资源");return;}
var domain=m[0];var host=m[2];var proxyPageURL=domain+"proxy.html";if(domain==("http://"+imgcacheDomain+"/"))
proxyPageURL="http://"+imgcacheDomain+"/ac/qzone/proxy.html";var f=frame.document.getElementsByTagName("iframe");for(var i=0;i<f.length;i++){var isRightProxy=false;try{isRightProxy=f[i].src.indexOf(proxyPageURL)==0}catch(e){}
if(isRightProxy){if(!callBackHsmp[host]&&typeof callBackHsmp[host]!="undefined"){f[i].contentWindow.loadXMLAsync(xID,xUrl,callback,err_callback,nocache,data,returnType);}else{if(typeof callBackHsmp[host]=="undefined")callBackHsmp[host]=[];callBackHsmp[host][callBackHsmp[host].length]={"callback":callback,"xID":xID,"xUrl":xUrl,"err_callback":err_callback,"nocache":nocache,"data":data,"returnType":returnType};}
return;}}
if(!callBackHsmp[host]){callBackHsmp[host]=[{"callback":callback,"xID":xID,"xUrl":xUrl,"err_callback":err_callback,"nocache":nocache,"data":data,"returnType":returnType}];createProxy(proxyPageURL);}}
function createProxy(src){var f=frame.document.getElementsByTagName("iframe");for(var i=0;i<f.length;i++)
if(f[i].src.indexOf(src)!=-1)return;var i=frame.document.createElement("iframe");var proxyDiv=frame.$("proxy");if(!proxyDiv)frame.document.body.insertBefore(i,null);else frame.$("proxy").appendChild(i);i.width=0;i.height=0;if(!ua.ie){setTimeout(function(){i.src=src;i=null;},500);}else{i.src=src;i=null;}}
return{loadXMLAsync:loadXMLAsync}})();QPHOTO.util.loadJsonData=function(xID,url,callback,errcallback,refresh,charset,callbackFunctionName){if(QPHOTO.g_JData[xID]&&!refresh&&!QPHOTO.g_JData[xID].error){callback(QPHOTO.g_JData[xID]);return;}
var arg=arguments;charset=charset||"GB2312";var cFN=callbackFunctionName||"JsonCallback";var snd=new QZAPP.QZONE.JSONGetter(url,void(0),null,charset);snd.onSuccess=function(o){try{if(o.ret==-900){window.LoginBack=function(){arg.callee.apply(null,arg);};QZONE.FP.showLoginBox("photo",null,null,{"mode":1});}else{callback(QPHOTO.g_JData[xID]=o);}}catch(err){if(err.number&&err.number==-2146823281){}}};if(typeof errcallback=='function'){snd.onError=errcallback;}
snd.send(cFN);};QPHOTO.album={refresh:function(uin){var xId=uin+"_alist";QZAPP.QZONE.dataCenter.del(xId);}}
QPHOTO.photo={refresh:function(uin,aid){var xId=uin+"_plist_"+aid;QZAPP.QZONE.dataCenter.del(xId);}}
var maxLoopNum=VersionInfo.isWider()?9:7;try{if(QZONE.FP._t.QZONE.dataCenter.get("photoEnvironmeng")=="myhome"||QZONE.FP._t.g_OFPLite){maxLoopNum=7;}}catch(e){maxLoopNum=7;}
var loopImgSize=66;var empLoopImgSize=70;var loopBorderSize=70;var loopImgPadding=5;var loopSpeed=0.1;var PhotoLoop=new Class({initialize:function(stIndex){this.stIndex=parseInt(stIndex,10)||0;this.inited=false;},render:function(curIndex){try{sendPhotoPreReq(photoPreType);}catch(e){};curIndex=parseInt(curIndex,10);if(curIndex>=this.data.length){return;}
if(!this.inited){this.container.style.display="none";var str=[];for(var i=0;i<this.data.length;i++){str.push(Tpl.replace(this.picTpl,this.data[i],i));}
if(this.data.length>maxLoopNum){str.push(this.retTpl);}
this.container.innerHTML=this.tpl.replace("pic_list_str",str.join(""));this.loop=$("loop_list");this.loop.style.width=(loopBorderSize+loopImgPadding)*(this.data.length+1)+"px";}
if(curIndex<=this.stIndex){if(this.inited&&this.stIndex==0){this.changeCurrent(0);return;}
if(curIndex==0&&this.stIndex>=this.data.length-1-maxLoopNum){this.stIndex=curIndex;this._doRender(curIndex,true);}else{var d=Math.floor(maxLoopNum/2);var n=Math.ceil((this.stIndex-curIndex+1)/d);this.stIndex=Math.max(this.stIndex-n*d,0);this._doRender(curIndex);}}else if(curIndex>=this.stIndex+maxLoopNum-1){if(curIndex==this.data.length-1&&this.stIndex==0){if(this.data.length==maxLoopNum){this.changeCurrent(curIndex);}else{this.stIndex=this.data.length-1-Math.floor(maxLoopNum/2);this._doRender(curIndex,true);}}else{var d=Math.floor(maxLoopNum/2);var n=Math.ceil((curIndex-this.stIndex-maxLoopNum+2)/d);this.stIndex=this.stIndex+n*d;this._doRender(curIndex);}}else{this.changeCurrent(curIndex);}},_doRender:function(curIndex,skip){if(this.data.length<=maxLoopNum){this.stIndex=0;}else{}
for(var i=this.stIndex;i<Math.min(this.data.length,this.stIndex+maxLoopNum);i++){var size=i==curIndex?empLoopImgSize:loopImgSize;Img.preLoad($("loop_img_"+i),getNodeSubValue(this.data[i],"pre"),size,size);}
var stPos;if(!this.inited){stPos=maxLoopNum*(loopBorderSize+loopImgPadding);}else{stPos=QZONE.dom.getXY(this.loop)[0]-QZONE.dom.getXY(this.container)[0];if(skip){if(curIndex==0){stPos=maxLoopNum*(loopBorderSize+loopImgPadding);}else{stPos=-1*(this.data.length-1-maxLoopNum)*(loopBorderSize+loopImgPadding);}}}
var endPos=-1*this.stIndex*(loopBorderSize+loopImgPadding);this.loop.style.position="relative";if(this.data.length>maxLoopNum){var tw=new QZONE.Tween(this.loop,"left",QZONE.transitions.strongEaseIn,stPos+"px",endPos+"px",loopSpeed);tw.start();}else{this.loop.style.left=(stPos-(loopBorderSize+loopImgPadding)*(this.data.length))/2;}
this.container.style.display="";var btn;btn=$("btn_turn_right");if(this.stIndex+maxLoopNum>this.data.length){btn.className="miniature_right_none";btn.disabled=true;}else if(this.stIndex+maxLoopNum==this.data.length){if(this.data.length>maxLoopNum){btn.disabled=false;btn.className="miniature_right";}else{btn.className="miniature_right_none";btn.disabled=true;}}else{btn.disabled=false;btn.className="miniature_right";}
btn=$("btn_turn_left");if(this.stIndex==0){btn.className="miniature_left_none";btn.disabled=true;}else{btn.disabled=false;btn.className="miniature_left";}
if(this.data.length<=maxLoopNum){btn=$("btn_turn_left");btn.style.visibility="hidden";btn=$("btn_turn_right");btn.style.visibility="hidden";}
this.inited=true;if(typeof curIndex!="undefined"){this.changeCurrent(curIndex);}},turnLeft:function(curIndex,bSlow){this.stIndex=Math.max(this.stIndex-Math.floor(maxLoopNum/2),0);this._doRender();},turnRight:function(curIndex,bSlow){this.stIndex=this.stIndex+Math.floor(maxLoopNum/2);this._doRender();},turn2First:function(){this.inited=false;this.stIndex=0;this._doRender(0);},changeCurrent:function(index){if(this.preSel){Img.preLoad($("loop_img_"+this.preIndex),$("loop_img_"+this.preIndex).src,loopImgSize,loopImgSize);this.preSel.className="";}
try{this.preSel=$("loop_pic_"+index);this.preIndex=index;this.preSel.className="bor";Img.preLoad($("loop_img_"+index),$("loop_img_"+index).src,empLoopImgSize,empLoopImgSize);}catch(e){}},tpl:['<button id="btn_turn_left" onclick="Page.turnLeft();" title="上一页" class="miniature_left"><span>上一页</span></button>','<div class="miniature_list">','<p class="c_tx3 miniature_loading" style="display:none;">>LOADING.....</p>','<ul id="loop_list">','pic_list_str','</ul>','</div>','<button id="btn_turn_right" onclick="Page.turnRight();" title="下一页" class="miniature_right"><span>下一页</span></button>'].join(""),picTpl:['<li id="loop_pic_<%=index%>">','<a href="javascript:Page.turn2Index(\'<%=index%>\',true);" class="bor2">','<img id="loop_img_<%=index%>" style="display:none;" src="about:blank;" title="<%=@name|%>" alt="<%=@desc|%>"/>','</a>','</li>'].join(""),retTpl:['<li>','<a href="javascript:Page.turn2First();" class="bor2" style="padding:0; width:68px; height:68px;">','<img src="/ac/qzone_v5/photo/back_first.png" alt="返回第一张" style="width:68px;height:68px;"/>','</a>','</li>'].join("")})/*  |xGv00|83c162ecadc477beef802a81e5946ffc */